simple$Jvar<-ifelse(simple$var=="speciesALNGLU:cc", 5.9, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesBETPEN:cc", 5.8, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFAGSYL:cc", 5.7, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFRAEXC:cc", 5.6, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesQUEROB:cc", 5.5, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="(Intercept)", 5, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesALNGLU", 5.9, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesBETPEN", 5.8, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFAGSYL", 5.7, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFRAEXC", 5.6, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesQUEROB", 5.5, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="m.index:cc", 4, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="sp.temp:cc", 3, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="sm.elev:cc", 2, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="space:cc", 1, simple$Jvar)
cols <- colorRampPalette(brewer.pal(7,"Accent"))(7)
estimates<-c("NAO Index", "Mean Spring Temperature", "Elevation", "Space Parameter", "Species",
"NAO Index x \nClimate Change", "Mean Spring Temperature \nx Climate Change",
"Elevation x \nClimate Chnage", "Space Parameter \nx Climate Change")
estimates<-rev(estimates)
expB<-ggplot(simple, aes(x=`2.5%`, xend=`97.5%`, y=Jvar, yend=Jvar, col=as.factor(species))) +
geom_vline(xintercept=0, linetype="dotted") + geom_point(aes(x=mean, y=Jvar, col=as.factor(species))) +
scale_colour_manual(name="Species", values=cols,
labels=c("1"=expression(paste(italic("Aesculus hippocastanum"))),
"2"=expression(paste(italic("Alnus glutinosa"))),
"3"=expression(paste(italic("Betula lenta"))),
"4"=expression(paste(italic("Fagus sylvatica"))),
"5"=expression(paste(italic("Fraxinus excelsior"))),
"6"=expression(paste(italic("Quercus robur"))),
"0"="Interactive Effect"))+
geom_segment(arrow = arrow(length = unit(0.00, "npc"))) +
scale_y_discrete(limits = sort(unique(simple$var)), labels=estimates) +
xlab("Change in Number of False Springs") + ylab("") +
theme(legend.text=element_text(size=5), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="sans"), legend.position = c(0.85,0.15),
legend.text.align = 0) #+ coord_cartesian(ylim=c(1,5), xlim=c(-20, 10))
quartz()
expB
plotting <- as.data.frame(summary(post.inter)$summary)
simple<-plotting
simple$var<- rownames(simple)
rownames(simple)<-1:45
simple<-simple[2:40,]
simple<-simple[!(simple$var=="speciesALNGLU"|simple$var=="speciesBETPEN"|simple$var=="speciesFAGSYL"|
simple$var=="speciesFRAEXC"|simple$var=="QUEROB"),]
simple<-subset(simple, select=c("var", "mean", "2.5%", "97.5%"))
simple$species<-c(1,1,1,1,1,1,2,3,4,5,6,2,3,4,5,6,2,3,4,5,6,2,3,4,5,6,2,3,4,5,6,2,3,4,5,6,0,0,0,0)
simple$Jvar<-NA
simple$Jvar<-ifelse(simple$var=="m.index", 9, simple$Jvar)
simple<-plotting
simple$var<- rownames(simple)
rownames(simple)<-1:45
simple<-simple[2:40,]
simple<-simple[!(simple$var=="speciesALNGLU"|simple$var=="speciesBETPEN"|simple$var=="speciesFAGSYL"|
simple$var=="speciesFRAEXC"|simple$var=="QUEROB"),]
simple<-subset(simple, select=c("var", "mean", "2.5%", "97.5%"))
simple$species<-c(1,1,1,1,1,6,2,3,4,5,6,2,3,4,5,6,2,3,4,5,6,2,3,4,5,6,2,3,4,5,6,0,0,0,0)
simple$Jvar<-NA
simple$Jvar<-ifelse(simple$var=="m.index", 9, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="m.index:speciesALNGLU", 8.9, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="m.index:speciesBETPEN", 8.8, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="m.index:speciesFAGSYL", 8.7, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="m.index:speciesFRAEXC", 8.6, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="m.index:speciesQUEROB", 8.5, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="sp.temp", 8, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesALNGLU:sp.temp", 7.9, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesBETPEN:sp.temp", 7.8, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFAGSYL:sp.temp", 7.7, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFRAEXC:sp.temp", 7.6, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesQUEROB:sp.temp", 7.5, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="sm.elev", 7, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesALNGLU:sm.elev", 6.9, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesBETPEN:sm.elev", 6.8, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFAGSYL:sm.elev", 6.7, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFRAEXC:sm.elev", 6.6, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesQUEROB:sm.elev", 6.5, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="space", 6, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesALNGLU:space", 5.9, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesBETPEN:space", 5.8, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFAGSYL:space", 5.7, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFRAEXC:space", 5.6, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesQUEROB:space", 5.5, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="cc", 5, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesALNGLU:cc", 4.9, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesBETPEN:cc", 4.8, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFAGSYL:cc", 4.7, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFRAEXC:cc", 4.6, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesQUEROB:cc", 4.5, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="m.index:cc", 4, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="sp.temp:cc", 3, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="sm.elev:cc", 2, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="space:cc", 1, simple$Jvar)
cols <- colorRampPalette(brewer.pal(7,"Accent"))(7)
estimates<-c("NAO Index", "Mean Spring Temperature", "Elevation", "Space Parameter", "Species",
"NAO Index x \nClimate Change", "Mean Spring Temperature \nx Climate Change",
"Elevation x \nClimate Chnage", "Space Parameter \nx Climate Change")
estimates<-rev(estimates)
expB<-ggplot(simple, aes(x=`2.5%`, xend=`97.5%`, y=Jvar, yend=Jvar, col=as.factor(species))) +
geom_vline(xintercept=0, linetype="dotted") + geom_point(aes(x=mean, y=Jvar, col=as.factor(species))) +
scale_colour_manual(name="Species", values=cols,
labels=c("1"=expression(paste(italic("Aesculus hippocastanum"))),
"2"=expression(paste(italic("Alnus glutinosa"))),
"3"=expression(paste(italic("Betula lenta"))),
"4"=expression(paste(italic("Fagus sylvatica"))),
"5"=expression(paste(italic("Fraxinus excelsior"))),
"6"=expression(paste(italic("Quercus robur"))),
"0"="Interactive Effect"))+
geom_segment(arrow = arrow(length = unit(0.00, "npc"))) +
scale_y_discrete(limits = sort(unique(simple$var)), labels=estimates) +
xlab("Change in Number of False Springs") + ylab("") +
theme(legend.text=element_text(size=5), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="sans"), legend.position = c(0.85,0.15),
legend.text.align = 0) #+ coord_cartesian(ylim=c(1,5), xlim=c(-20, 10))
expB
simple<-plotting
simple$var<- rownames(simple)
rownames(simple)<-1:45
simple<-simple[2:40,]
simple<-simple[!(simple$var=="speciesALNGLU"|simple$var=="speciesBETPEN"|simple$var=="speciesFAGSYL"|
simple$var=="speciesFRAEXC"|simple$var=="speciesQUEROB"),]
simple<-subset(simple, select=c("var", "mean", "2.5%", "97.5%"))
simple$species<-c(1,1,1,1,1,2,3,4,5,6,2,3,4,5,6,2,3,4,5,6,2,3,4,5,6,2,3,4,5,6,0,0,0,0)
simple$Jvar<-NA
simple$Jvar<-ifelse(simple$var=="m.index", 9, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="m.index:speciesALNGLU", 8.9, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="m.index:speciesBETPEN", 8.8, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="m.index:speciesFAGSYL", 8.7, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="m.index:speciesFRAEXC", 8.6, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="m.index:speciesQUEROB", 8.5, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="sp.temp", 8, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesALNGLU:sp.temp", 7.9, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesBETPEN:sp.temp", 7.8, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFAGSYL:sp.temp", 7.7, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFRAEXC:sp.temp", 7.6, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesQUEROB:sp.temp", 7.5, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="sm.elev", 7, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesALNGLU:sm.elev", 6.9, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesBETPEN:sm.elev", 6.8, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFAGSYL:sm.elev", 6.7, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFRAEXC:sm.elev", 6.6, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesQUEROB:sm.elev", 6.5, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="space", 6, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesALNGLU:space", 5.9, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesBETPEN:space", 5.8, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFAGSYL:space", 5.7, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFRAEXC:space", 5.6, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesQUEROB:space", 5.5, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="cc", 5, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesALNGLU:cc", 4.9, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesBETPEN:cc", 4.8, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFAGSYL:cc", 4.7, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesFRAEXC:cc", 4.6, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="speciesQUEROB:cc", 4.5, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="m.index:cc", 4, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="sp.temp:cc", 3, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="sm.elev:cc", 2, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="space:cc", 1, simple$Jvar)
cols <- colorRampPalette(brewer.pal(7,"Accent"))(7)
estimates<-c("NAO Index", "Mean Spring Temperature", "Elevation", "Space Parameter", "Species",
"NAO Index x \nClimate Change", "Mean Spring Temperature \nx Climate Change",
"Elevation x \nClimate Chnage", "Space Parameter \nx Climate Change")
estimates<-rev(estimates)
post.inter
load("~/Documents/git/regionalrisk/analyses/output/brm_slopes_fast.Rdata")
library(rstan)
library(rstanarm)
library(sjPlot)
library(sjmisc)
library(RColorBrewer)
library(dplyr)
library(broom)
brms<-as.data.frame(tidy(slopes.fast,robust = TRUE))
View(brms)
load("~/Documents/git/regionalrisk/analyses/scripts/brm_slopes_fast.Rdata")
brms<-as.data.frame(tidy(slopes.fast,robust = TRUE))
View(brms)
brms<-brms[2:46,]
brms$term<-gsub("b_.*","",term$var)
brms$term<-gsub("r_species.*","",term$var)
brms$term<-gsub("b_.*","",brms$term)
brms$term<-gsub("r_species.*","",brms$term)
brms<-as.data.frame(tidy(slopes.fast,robust = TRUE))
brms<-brms[2:46,]
brms$term<-gsub(".*b_","",brms$term)
brms$term<-gsub(".*r_species","",brms$term)
brms<-brms[!(11:16),]
brms<-as.data.frame(tidy(slopes.fast,robust = TRUE))
brms<-brms[2:46,]
brms$term<-gsub(".*b_","",brms$term)
brms$term<-gsub(".*r_species","",brms$term)
brms<-brms[!11:16,]
brms<-as.data.frame(tidy(slopes.fast,robust = TRUE))
brms<-brms[2:46,]
brms$term<-gsub(".*b_","",brms$term)
brms$term<-gsub(".*r_species","",brms$term)
brms<-brms[!(brms$term=="sd_species_m.index" |brms$term=="sd_species_sp.temp") | brms$term=="sd_species_sm.elev"
| brms$term=="sd_species_space" | brms$term=="sd_species_cc"),]
brms<-brms[!(brms$term=="sd_species_m.index" | brms$term=="sd_species_sp.temp" | brms$term=="sd_species_sm.elev"
| brms$term=="sd_species_space" | brms$term=="sd_species_cc"),]
brms<-brms[!(brms$term=="sd_species__m.index" | brms$term=="sd_species__sp.temp" | brms$term=="sd__species_sm.elev"
| brms$term=="sd_species__space" | brms$term=="sd_species__cc" | brms$term=="sigma"),]
brms<-brms[!(brms$term=="sd_species__m.index" | brms$term=="sd_species__sp.temp" | brms$term=="sd__species__sm.elev"
| brms$term=="sd_species__space" | brms$term=="sd_species__cc" | brms$term=="sigma"),]
brms<-brms[!(brms$term=="sd_species__m.index" | brms$term=="sd_species__sp.temp" | brms$term=="sd_species__sm.elev"
| brms$term=="sd_species__space" | brms$term=="sd_species__cc" | brms$term=="sigma"),]
brms$species<-c(0,0,0,0,0,1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6,0,0,0,0)
brms$species<-c(0,0,0,0,0,0,0,0,0, 1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6)
brms$Jvar<-NA
brms$Jvar<-ifelse(brms$term=="m.index", 9, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[AESHIP,m.index]", 8.9, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[ALNGLU,m.index]", 8.8, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[BETPEN,m.index]", 8.7, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[FAGSYL,m.index]", 8.6, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[FRAEXC,m.index]", 8.5, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[QUEROB,m.index]", 8.4, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="sp.temp", 8, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[AESHIP,sp.temp]", 7.9, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[ALNGLU,sp.temp]", 7.8, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[BETPEN,sp.temp]", 7.7, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[FAGSYL,sp.temp]", 7.6, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[FRAEXC,sp.temp]", 7.5, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[QUEROB,sp.temp]", 7.4, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="sm.elev", 7, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[AESHIP,sm.elev]", 6.9, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[ALNGLU,sm.elev]", 6.8, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[BETPEN,sm.elev]", 6.7, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[FAGSYL,sm.elev]", 6.6, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[FRAEXC,sm.elev]", 6.5, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[QUEROB,sm.elev]", 6.4, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="space", 6, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[AESHIP,space]", 5.9, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[ALNGLU,space]", 5.8, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[BETPEN,space]", 5.7, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[FAGSYL,space]", 5.6, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[FRAEXC,space]", 5.5, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[QUEROB,space]", 5.4, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="cc", 5, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[AESHIP,cc]", 4.9, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[ALNGLU,cc]", 4.8, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[BETPEN,cc]", 4.7, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[FAGSYL,cc]", 4.6, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[FRAEXC,cc]", 4.5, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="[QUEROB,cc]", 4.4, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="m.index:cc", 4, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="sp.temp:cc", 3, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="cc:sm.elev", 2, brms$Jvar)
brms$Jvar<-ifelse(brms$term=="cc:space", 1, brms$Jvar)
cols <- colorRampPalette(brewer.pal(9,"Set1"))(7)
estimates<-c("NAO Index", "Mean Spring Temperature", "Elevation", "Space Parameter", "Climate Change",
"NAO Index x \nClimate Change", "Mean Spring Temperature \nx Climate Change",
"Elevation x \nClimate Chnage", "Space Parameter \nx Climate Change")
estimates<-rev(estimates)
regrisk<-ggplot(brms, aes(x=lower, xend=upper, y=Jvar, yend=Jvar, col=as.factor(species))) +
geom_vline(xintercept=0, linetype="dotted") + geom_point(aes(x=estimate, y=Jvar, col=as.factor(species), size=as.factor(species))) +
scale_colour_manual(name="Species", values=cols,
labels=c("1"=expression(paste(italic("Aesculus hippocastanum"))),
"2"=expression(paste(italic("Alnus glutinosa"))),
"3"=expression(paste(italic("Betula lenta"))),
"4"=expression(paste(italic("Fagus sylvatica"))),
"5"=expression(paste(italic("Fraxinus excelsior"))),
"6"=expression(paste(italic("Quercus robur"))),
"0"="Overall Effects"))+
geom_segment(arrow = arrow(length = unit(0.00, "npc"))) +
scale_y_discrete(limits = sort(unique(brms$term)), labels=estimates) +
xlab("Change in Number of False Springs") + ylab("") + theme_linedraw() +
theme(legend.text=element_text(size=5), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="sans"), legend.position = c(0.85,0.25),
legend.text.align = 0) + #+ coord_cartesian(ylim=c(1,5), xlim=c(-20, 10))
scale_size_manual(values=c(3, 1, 1, 1, 1, 1, 1, 1, 1, 1), name="Species",
labels=c("1"=expression(paste(italic("Aesculus hippocastanum"))),
"2"=expression(paste(italic("Alnus glutinosa"))),
"3"=expression(paste(italic("Betula lenta"))),
"4"=expression(paste(italic("Fagus sylvatica"))),
"5"=expression(paste(italic("Fraxinus excelsior"))),
"6"=expression(paste(italic("Quercus robur"))),
"0"="Overall Effects"))
quartz()
regrisk
brms<-as.data.frame(tidy(slopes.fast,robust = TRUE))
load("~/Documents/git/regionalrisk/analyses/scripts/brm_biglm.Rdata")
brm.biglm
rm(list=ls()) # remove everything currently held in the R memory
options(stringsAsFactors=FALSE)
graphics.off()
forlatex = TRUE # set to FALSE if just trying new figures, TRUE if outputting for final
runstan = TRUE # set to TRUE to actually run stan models. FALSE if loading from previous runs
# Analysis of bud burst experiment 2015.
library(ggplot2)
#library(rstan)
#library(rstanarm)
#library(shinystan)
#library(bayesplot)
library(dplyr)
#library(gridExtra)
library(brms)
library(egg)
library(ggstance)
library(RColorBrewer)
setwd("~/Documents/git/springfreeze/")
load(file="output/exp_output.Rdata")
m<-fit.brm2
m.int<-posterior_interval(m)
sum.m<-summary(m)
cri.f<-as.data.frame(sum.m$fixed[,c("Estimate", "l-95% CI", "u-95% CI")])
cri.f<-cri.f[-1,] #removing the intercept
fdf1<-as.data.frame(rbind(as.vector(cri.f[,1]), as.vector(cri.f[,2]), as.vector(cri.f[,3])))
fdf2<-cbind(fdf1, c(0, 0, 0) , c("Estimate", "2.5%", "95%"))
names(fdf2)<-c(rownames(cri.f), "sp", "perc")
cri.r<-(ranef(m, summary = TRUE, robust = FALSE,
probs = c(0.025, 0.975)))$sp
cri.r2<-cri.r[, ,-1]
cri.r2<-cri.r2[,-2,]
dims<-dim(cri.r2)
twoDimMat <- matrix(cri.r2, prod(dims[1:2]), dims[3])
mat2<-cbind(twoDimMat, c(rep(1:9, length.out=27)), rep(c("Estimate", "2.5%", "95%"), each=9))
df<-as.data.frame(mat2)
names(df)<-c(rownames(cri.f), "sp", "perc")
dftot<-rbind(fdf2, df)
dflong<- tidyr::gather(dftot, var, value, force:`photo:chill2`, factor_key=TRUE)
#adding the coef estiamtes to the random effect values
for (i in seq(from=1,to=nrow(dflong), by=30)) {
for (j in seq(from=3, to=29, by=1)) {
dflong$value[i+j]<- as.numeric(dflong$value[i+j]) + as.numeric(dflong$value[i])
}
}
dflong$rndm<-ifelse(dftot$sp>0, 2, 1)
dfwide<-tidyr::spread(dflong, perc, value)
dfwide[,4:6] <- as.data.frame(lapply(c(dfwide[,4:6]), as.numeric ))
dfwide$sp<-as.factor(dfwide$sp)
simple<-subset(dfwide, select=c("sp", "var", "Estimate"))
#simple<-simple[(simple$sp=="1"|simple$sp=="4"|simple$sp=="8"),]
#simple$sp<-ifelse(simple$sp=="4", "1", "9")
species<-c("1", "6", "8")
simple<-subset(simple, sp%in%species)
#simple<-simple[!(simple$sp=="0"),]
simple<-simple[!(simple$var=="photo:chill1" | simple$var=="photo:chill2" | simple$var=="force:chill1"
| simple$var=="chill1"),]
simple$var<-ifelse(simple$var=="chill2", "chill", as.character(simple$var))
simple$var<-ifelse(simple$var=="force:chill2", "force:chill", as.character(simple$var))
estimates<-c("More Forcing", "Shorter Photoperiod", "Less Chilling", "Interaction of More Forcing \nand Shorter Photoperiod", "Interaction of More Forcing \nand Less Chilling",
"More Forcing and \nShorter Photoperiod", "More Forcing and \nLess Chilling")
#estimates2<-c("More Forcing", "Longer Photoperiod", "More Chilling", "More Forcing and \nLonger Photoperiod",
#            "More Forcing and \nMore Chilling")
#pd <- position_dodgev(height = -0.5)
#simple$Jvar <- ave(as.numeric(simple$var), simple$var,
#                         FUN = function(x) x + rnorm(length(x), sd = .1))
simple$Jvar<-NA
simple$Jvar<-ifelse(simple$var=="force", 7, simple$var)
simple$Jvar<-ifelse(simple$var=="photo", 6, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="chill", 5, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="force:photo", 2, simple$Jvar)
simple$Jvar<-ifelse(simple$var=="force:chill", 1, simple$Jvar)
#simple$Jvar<-ifelse(simple$var=="cforce:photo", 2, simple$Jvar)
#simple$Jvar<-ifelse(simple$var=="cforce:chill", 1, simple$Jvar)
simple$Jvar2<-as.numeric(simple$Jvar)
simple$spp<-NA
simple$spp<-ifelse(simple$sp=="1", 1, simple$spp)
simple$spp<-ifelse(simple$sp=="6", 2, simple$spp)
simple$spp<-ifelse(simple$sp=="8", 3, simple$spp)
#simple$spp<-as.numeric(simple$sp)-1
simple$spp<-ifelse(simple$spp>1, (simple$spp*0.1) - 0.1, 0)
simple$Jvar2<-as.numeric(simple$Jvar)-simple$spp
#simple$Jvar2<-ifelse(simple$sp=="4", simple$Jvar2-0.1, simple$Jvar2)
#simple$Jvar2<-ifelse(simple$sp=="8", simple$Jvar2-0.2, simple$Jvar2)
simple$newEstimate<-simple$Estimate
simple$newEstimate<-ifelse(simple$var=="photo", -simple$Estimate, simple$newEstimate)
simple$newEstimate<-ifelse(simple$var=="chill", -simple$Estimate, simple$newEstimate)
simple$newEstimate<-ifelse(simple$var=="force:photo", -simple$Estimate, simple$newEstimate)
simple$newEstimate<-ifelse(simple$var=="force:chill", -simple$Estimate, simple$newEstimate)
simple$sp<-as.numeric(simple$sp)-1
species<-unique(simple$sp)
simple$est2<-simple$newEstimate
for(i in c(1:length(species))) {
simple$est2<-ifelse(simple$sp==species[i] & simple$var=="force:photo", simple$newEstimate[simple$var=="force" & simple$sp==species[i]]+
simple$newEstimate[simple$var=="photo" & simple$sp==species[i]]+
simple$newEstimate[simple$var=="force:photo" & simple$sp==species[i]], simple$est2)
simple$est2<-ifelse(simple$sp==species[i] & simple$var=="force:chill", simple$newEstimate[simple$var=="force" & simple$sp==species[i]]+
simple$newEstimate[simple$var=="chill" & simple$sp==species[i]]+
simple$newEstimate[simple$var=="force:chill" & simple$sp==species[i]], simple$est2)
}
#simple$est1<-simple$Estimate
#for(i in c(1:length(species))) {
# simple$est1<-ifelse(simple$sp==species[i] & simple$var=="force:photo", simple$Estimate[simple$var=="force" & simple$sp==species[i]]+
# simple$Estimate[simple$var=="photo" & simple$sp==species[i]]+
#  simple$Estimate[simple$var=="force:photo" & simple$sp==species[i]], simple$est1)
#  simple$est1<-ifelse(simple$sp==species[i] & simple$var=="force:chill", simple$Estimate[simple$var=="force" & simple$sp==species[i]]+
# simple$Estimate[simple$var=="chill" & simple$sp==species[i]]+
#  simple$Estimate[simple$var=="force:chill" & simple$sp==species[i]], simple$est1)
#}
simple<-rbind(simple,list(1,"force:photo2",0, 3, 4, 0, 0, simple$newEstimate[simple$sp==1 & simple$var=="force:photo"], 0))
simple<-rbind(simple,list(6,"force:photo2",0, 3, 3.9, 0, 0, simple$newEstimate[simple$sp==6 & simple$var=="force:photo"], 0))
simple<-rbind(simple,list(8,"force:photo2",0, 3, 3.8, 0, 0, simple$newEstimate[simple$sp==8 & simple$var=="force:photo"], 0))
simple<-rbind(simple,list(1,"force:chill2",0, 1, 3, 0, 0, simple$newEstimate[simple$sp==1 & simple$var=="force:chill"], 0))
simple<-rbind(simple,list(6,"force:chill2",0, 1, 2.9, 0, 0, simple$newEstimate[simple$sp==6 & simple$var=="force:chill"], 0))
simple<-rbind(simple,list(8,"force:chill2",0, 1, 2.8, 0, 0, simple$newEstimate[simple$sp==8 & simple$var=="force:chill"], 0))
#simple$est3<-simple$est2+23.71
#simple$est4<-simple$est1+23.71
estimates<-rev(estimates)
#estimates2<-rev(estimates2)
cols <- colorRampPalette(brewer.pal(3,"Accent"))(3)
expB<-ggplot(simple, aes(x=0, xend=est2, y=Jvar2, yend=Jvar2, col=as.factor(sp))) +
geom_vline(xintercept=0, linetype="dotted") +
scale_colour_manual(name="Species", values=cols,
labels=c("1"=expression(paste(italic("Acer \npensylvanicum"))),
"2"=expression(paste(italic("Acer rubrum"))),
"3"=expression(paste(italic("Acer saccharum"))),
"4"=expression(paste(italic("Betula alleghaniensis"))),
"5"=expression(paste(italic("Betula papyrifera"))),
"6"=expression(paste(italic("Fagus \ngrandifolia"))),
"7"=expression(paste(italic("Ilex mucronata"))),
"8"=expression(paste(italic("Populus \ngrandidentata"))),
"9"=expression(paste(italic("Quercus rubra"))))) +
scale_linetype_manual(name="Species", values=c("solid", "longdash", "dotdash"),
labels=c("1"=expression(paste(italic("Acer \npensylvanicum"))),
"2"=expression(paste(italic("Acer rubrum"))),
"3"=expression(paste(italic("Acer saccharum"))),
"4"=expression(paste(italic("Betula alleghaniensis"))),
"5"=expression(paste(italic("Betula papyrifera"))),
"6"=expression(paste(italic("Fagus \ngrandifolia"))),
"7"=expression(paste(italic("Ilex mucronata"))),
"8"=expression(paste(italic("Populus \ngrandidentata"))),
"9"=expression(paste(italic("Quercus rubra"))))) +
geom_segment(arrow = arrow(length = unit(0.02, "npc")), aes(linetype=as.factor(sp))) +
scale_y_discrete(limits = sort(unique(simple$var)), labels=estimates) +
xlab("Change in Duration (Days) \nof Vegetative Risk") + ylab("") +
geom_hline(yintercept=2.5, col="grey") +
annotate("text", x = -16.1, y = 2.4, label = "COMBINED EFFECTS:", fontface="bold", size=2.5) +
annotate("text", x = -13.4, y = 7.5, label = "ESTIMATED ISOLATED EFFECTS:", fontface="bold", size=2.5) +
theme_linedraw() +
theme(legend.text=element_text(size=5), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="sans"), legend.position = c(0.85,0.15),
legend.text.align = 0) + coord_cartesian(ylim=c(1,7), xlim=c(-20, 10))
quartz()
expB
expB<-ggplot(simple, aes(x=0, xend=est2, y=Jvar2, yend=Jvar2, col=as.factor(sp))) +
geom_vline(xintercept=0, linetype="dotted") +
scale_colour_manual(name="Species", values=cols,
labels=c("1"=expression(paste(italic("Acer \npensylvanicum"))),
"2"=expression(paste(italic("Acer rubrum"))),
"3"=expression(paste(italic("Acer saccharum"))),
"4"=expression(paste(italic("Betula alleghaniensis"))),
"5"=expression(paste(italic("Betula papyrifera"))),
"6"=expression(paste(italic("Fagus \ngrandifolia"))),
"7"=expression(paste(italic("Ilex mucronata"))),
"8"=expression(paste(italic("Populus \ngrandidentata"))),
"9"=expression(paste(italic("Quercus rubra"))))) +
scale_linetype_manual(name="Species", values=c("solid", "longdash", "dotdash"),
labels=c("1"=expression(paste(italic("Acer \npensylvanicum"))),
"2"=expression(paste(italic("Acer rubrum"))),
"3"=expression(paste(italic("Acer saccharum"))),
"4"=expression(paste(italic("Betula alleghaniensis"))),
"5"=expression(paste(italic("Betula papyrifera"))),
"6"=expression(paste(italic("Fagus \ngrandifolia"))),
"7"=expression(paste(italic("Ilex mucronata"))),
"8"=expression(paste(italic("Populus \ngrandidentata"))),
"9"=expression(paste(italic("Quercus rubra"))))) +
geom_segment(arrow = arrow(length = unit(0.02, "npc")), aes(linetype=as.factor(sp))) +
scale_y_discrete(limits = sort(unique(simple$var)), labels=estimates) +
xlab("Change in Duration (Days) \nof Vegetative Risk") + ylab("") +
geom_hline(yintercept=2.5, col="grey") +
annotate("text", x = -16.1, y = 2.4, label = "COMBINED EFFECTS:", fontface="bold", size=2.5) +
annotate("text", x = -13.4, y = 7.5, label = "ESTIMATED ISOLATED EFFECTS:", fontface="bold", size=2.5) +
theme_linedraw() +
theme(legend.text=element_text(size=5), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="Helvetica"), legend.position = c(0.85,0.15),
legend.text.align = 0) + coord_cartesian(ylim=c(1,7), xlim=c(-20, 10))
expB
expB<-ggplot(simple, aes(x=0, xend=est2, y=Jvar2, yend=Jvar2, col=as.factor(sp))) +
geom_vline(xintercept=0, linetype="dotted") +
scale_colour_manual(name="Species", values=cols,
labels=c("1"=expression(paste(italic("Acer \npensylvanicum"))),
"2"=expression(paste(italic("Acer rubrum"))),
"3"=expression(paste(italic("Acer saccharum"))),
"4"=expression(paste(italic("Betula alleghaniensis"))),
"5"=expression(paste(italic("Betula papyrifera"))),
"6"=expression(paste(italic("Fagus \ngrandifolia"))),
"7"=expression(paste(italic("Ilex mucronata"))),
"8"=expression(paste(italic("Populus \ngrandidentata"))),
"9"=expression(paste(italic("Quercus rubra"))))) +
scale_linetype_manual(name="Species", values=c("solid", "longdash", "dotdash"),
labels=c("1"=expression(paste(italic("Acer \npensylvanicum"))),
"2"=expression(paste(italic("Acer rubrum"))),
"3"=expression(paste(italic("Acer saccharum"))),
"4"=expression(paste(italic("Betula alleghaniensis"))),
"5"=expression(paste(italic("Betula papyrifera"))),
"6"=expression(paste(italic("Fagus \ngrandifolia"))),
"7"=expression(paste(italic("Ilex mucronata"))),
"8"=expression(paste(italic("Populus \ngrandidentata"))),
"9"=expression(paste(italic("Quercus rubra"))))) +
geom_segment(arrow = arrow(length = unit(0.02, "npc")), aes(linetype=as.factor(sp))) +
scale_y_discrete(limits = sort(unique(simple$var)), labels=estimates) +
xlab("Change in Duration (Days) \nof Vegetative Risk") + ylab("") +
geom_hline(yintercept=2.5, col="grey") +
annotate("text", x = -16.1, y = 2.4, label = "COMBINED EFFECTS:", fontface="bold", size=2.5, family="Helvetica") +
annotate("text", x = -13.4, y = 7.5, label = "ESTIMATED ISOLATED EFFECTS:", fontface="bold", size=2.5, family="Helvetica") +
theme_linedraw() +
theme(legend.text=element_text(size=5), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),
text=element_text(family="Helvetica"), legend.position = c(0.85,0.15),
legend.text.align = 0) + coord_cartesian(ylim=c(1,7), xlim=c(-20, 10))
expB
