retention<- observers%>%
select(ObservedBy_Person_ID,Observation_Date) %>%
group_by(ObservedBy_Person_ID) %>%
summarize_each(funs(first))
date <- as.Date(
retention$Observation_Date, "%m/%d/%y")
rate<- retention %>%
filter(date >= '2016-01-01')
source('~/Documents/git/treespotters/Data/Tree Spotters Update.R', echo=TRUE)
obs.all<- update %>%
select (Observation_Date, Phenophase_Status, Common_Name,
Phenophase_Description,Plant_Nickname, Day_of_Year,
Species_ID, ObservedBy_Person_ID)
date.obs <- as.Date(
obs.all$Observation_Date, "%m/%d/%y")
obs.all1 <- obs.all %>%
filter(date.obs >= "2016/01/01") %>%
group_by(Plant_Nickname,ObservedBy_Person_ID)%>%
select(Day_of_Year,Plant_Nickname,ObservedBy_Person_ID,Common_Name)%>%
filter(row_number()==1)
obs.count<-count(obs.all1,Plant_Nickname)
obs<-full_join(obs.count,obs.all1, by = "Plant_Nickname")%>%
group_by(Plant_Nickname)%>%
filter(row_number()==1) %>%
select(-ObservedBy_Person_ID)
qplot(Common_Name,n, data = obs,
geom = "boxplot", color=Common_Name) +
xlab("Species")+ylab("# of Observers")
# Observers per Tree
total<- update %>%
select (Observation_Date, Common_Name, Plant_Nickname, Day_of_Year,
Observation_ID)
date.tot <- as.Date(
total$Observation_Date, "%m/%d/%y")
total1 <- total %>%
filter(date.tot >= "2016/01/01") %>%
group_by(Plant_Nickname,Observation_ID)%>%
select(Day_of_Year,Plant_Nickname,Observation_ID, Common_Name)
total.count<-count(total1,Plant_Nickname)
tot<-full_join(total.count,total1, by = "Plant_Nickname")%>%
group_by(Plant_Nickname)%>%
filter(row_number()==1) %>%
select(-Observation_ID)
table<-left_join(tot,obs, by="Plant_Nickname")%>%
select(-Day_of_Year.x, -Day_of_Year.y, -Common_Name.x)
ggplot(table,aes(x=n.x,y=n.y)) +
geom_point(aes(col=Common_Name.y)) + geom_smooth(method="lm") +
xlab("Total Observations")+ylab("Number of Observers")
obs.all<- update %>%
select(Observation_Date, Phenophase_Status, Common_Name,
Phenophase_Description,Plant_Nickname, Day_of_Year,
Species_ID, ObservedBy_Person_ID)
library(dplyr)
library(tidyr)
library(ggplot2)
obs.all<- update %>%
select(Observation_Date, Phenophase_Status, Common_Name,
Phenophase_Description,Plant_Nickname, Day_of_Year,
Species_ID, ObservedBy_Person_ID)
obs.all<- record %>%
select(Observation_Date, Phenophase_Status, Common_Name,
Phenophase_Description,Plant_Nickname, Day_of_Year,
Species_ID, ObservedBy_Person_ID)
date.obs <- as.Date(
obs.all$Observation_Date, "%m/%d/%y")
obs.all1 <- obs.all %>%
filter(date.obs >= "2016/01/01") %>%
group_by(Plant_Nickname,ObservedBy_Person_ID)%>%
select(Day_of_Year,Plant_Nickname,ObservedBy_Person_ID,Common_Name)%>%
filter(row_number()==1)
obs.count<-count(obs.all1,Plant_Nickname)
obs<-full_join(obs.count,obs.all1, by = "Plant_Nickname")%>%
group_by(Plant_Nickname)%>%
filter(row_number()==1) %>%
select(-ObservedBy_Person_ID)
qplot(Common_Name,n, data = obs,
geom = "boxplot", color=Common_Name) +
xlab("Species")+ylab("# of Observers")
total<- record %>%
select (Observation_Date, Common_Name, Plant_Nickname, Day_of_Year,
Observation_ID)
date.tot <- as.Date(
total$Observation_Date, "%m/%d/%y")
total1 <- total %>%
filter(date.tot >= "2016/01/01") %>%
group_by(Plant_Nickname,Observation_ID)%>%
select(Day_of_Year,Plant_Nickname,Observation_ID, Common_Name)
total.count<-count(total1,Plant_Nickname)
tot<-full_join(total.count,total1, by = "Plant_Nickname")%>%
group_by(Plant_Nickname)%>%
filter(row_number()==1) %>%
select(-Observation_ID)
table<-left_join(tot,obs, by="Plant_Nickname")%>%
select(-Day_of_Year.x, -Day_of_Year.y, -Common_Name.x)
ggplot(table,aes(x=n.x,y=n.y)) +
geom_point(aes(col=Common_Name.y)) + geom_smooth(method="lm") +
xlab("Total Observations")+ylab("Number of Observers")
View(obs.all)
obs.all1 <- obs.all %>%
filter(date.obs >= "2016/01/01") %>%
group_by(Plant_Nickname,ObservedBy_Person_ID)%>%
filter(row_number()==1)
View(obs.all1)
obs.count<-count(obs.all1,Plant_Nickname)
obs<-full_join(obs.count,obs.all1, by = "Plant_Nickname")%>%
group_by(Plant_Nickname)%>%
filter(row_number()==1) %>%
select(-ObservedBy_Person_ID)
View(obs)
qplot(Common_Name,n, data = obs,
geom = "boxplot", color=Common_Name) +
xlab("Species")+ylab("# of Observers")
obs.all1 <- obs.all %>%
filter(date.obs >= "2016/01/01") %>%
group_by(Plant_Nickname,ObservedBy_Person_ID)%>%
arrange(Plant_Nickname)%>%
filter(row_number()==1)
obs.count<-count(obs.all1,Plant_Nickname)
View(obs.count)
obs<-full_join(obs.count,obs.all1, by = "Plant_Nickname")%>%
group_by(Plant_Nickname)%>%
filter(row_number()==1) %>%
select(-ObservedBy_Person_ID)
View(obs)
qplot(Common_Name,n, data = obs,
geom = "boxplot", color=Common_Name) +
xlab("Species")+ylab("# of Observers")
obs<-full_join(obs.count,obs.all1, by = "Plant_Nickname")%>%
select(-ObservedBy_Person_ID)
qplot(Common_Name,n, data = obs,
geom = "boxplot", color=Common_Name) +
xlab("Species")+ylab("# of Observers")
View(obs)
obs.count<-as.data.frame(table(obs.all1,Plant_Nickname))
obs.count<-as.data.frame(table(obs.all1$Plant_Nickname))
obs<-full_join(obs.count,obs.all1, by = "Plant_Nickname")%>%
select(-ObservedBy_Person_ID)
qplot(Common_Name,n, data = obs,
geom = "boxplot", color=Common_Name) +
xlab("Species")+ylab("# of Observers")
View(obs)
View(obs.count)
qplot(Var1,Freq, data = obs.count,
geom = "boxplot", color=Var1) +
xlab("Species")+ylab("# of Observers")
obs<-full_join(obs.count,obs.all1)
obs<-full_join(obs.count,obs.all1, by="Plant_Nickname")
View(obs)
qplot(Common_Name,obs.count$Freq, data = obs,
geom = "boxplot", color=Common_Name) +
xlab("Species")+ylab("# of Observers")
obs.count<-as.data.frame(table(obs.all1$Plant_Nickname)) %>%
rename(Plant_Nickname = Var1) %>%
rename(Freq = n)
obs.count<-as.data.frame(table(obs.all1$Plant_Nickname)) %>%
rename(Plant_Nickname = Var1) %>%
rename(n = Freq)
obs<-full_join(obs.count,obs.all1, by="Plant_Nickname")
View(obs)
qplot(Common_Name, n, data = obs,
geom = "boxplot", color=Common_Name) +
xlab("Species")+ylab("# of Observers")
total<- record %>%
select (Observation_Date, Common_Name, Plant_Nickname, Day_of_Year,
Observation_ID)
date.tot <- as.Date(
total$Observation_Date, "%m/%d/%y")
total1 <- total %>%
filter(date.tot >= "2016/01/01") %>%
group_by(Plant_Nickname,Observation_ID)%>%
select(Day_of_Year,Plant_Nickname,Observation_ID, Common_Name)
total.count<-count(total1,Plant_Nickname)
tot<-full_join(total.count,total1, by = "Plant_Nickname")%>%
group_by(Plant_Nickname)%>%
filter(row_number()==1) %>%
select(-Observation_ID)
table<-left_join(tot,obs, by="Plant_Nickname")%>%
select(-Day_of_Year.x, -Day_of_Year.y, -Common_Name.x)
ggplot(table,aes(x=n.x,y=n.y)) +
geom_point(aes(col=Common_Name.y)) + geom_smooth(method="lm") +
xlab("Total Observations")+ylab("Number of Observers")
View(total1)
View(total.count)
total.count<-as.data.frame(table(total1,Plant_Nickname))
tot<-full_join(total.count,total1, by = "Plant_Nickname")%>%
group_by(Plant_Nickname)%>%
filter(row_number()==1) %>%
select(-Observation_ID)
table<-left_join(tot,obs, by="Plant_Nickname")%>%
select(-Day_of_Year.x, -Day_of_Year.y, -Common_Name.x)
ggplot(table,aes(x=n.x,y=n.y)) +
geom_point(aes(col=Common_Name.y)) + geom_smooth(method="lm") +
xlab("Total Observations")+ylab("Number of Observers")
View(total1)
View(total1)
total.count<-as.data.frame(table(total1$Plant_Nickname))
total.count<-as.data.frame(table(total1$Plant_Nickname)) %>%
rename(Plant_Nickname = Var1) %>%
rename(n = Freq)
tot<-full_join(total.count,total1, by = "Plant_Nickname")%>%
group_by(Plant_Nickname)%>%
filter(row_number()==1) %>%
select(-Observation_ID)
table<-left_join(tot,obs, by="Plant_Nickname")%>%
select(-Day_of_Year.x, -Day_of_Year.y, -Common_Name.x)
ggplot(table,aes(x=n.x,y=n.y)) +
geom_point(aes(col=Common_Name.y)) + geom_smooth(method="lm") +
xlab("Total Observations")+ylab("Number of Observers")
rm(list=ls()) # remove everything currently held in the R memory
options(stringsAsFactors=FALSE)
graphics.off()
# Load libraries
library(dplyr)
library(tidyr)
library(ggplot2)
# Set Working Directory
setwd("~/Documents/git/springfreeze")
phenology<-read.csv("input/condensed_phenometrics.csv",header=TRUE)
phases<-c("Budburst","Leaves")
pheno<-phenology%>%
select(Site_ID, Genus, Species, Individual_ID, Phenophase_Description, First_Yes_DOY, First_Yes_Year, Latitude, Longitude) %>%
unite(species, Genus, Species, sep="_") %>%
filter(Phenophase_Description %in% phases) %>%
filter(Site_ID == 6242) %>%
rename(Year = First_Yes_Year)
# Make dataframe that includes Risk for each species
y0<-pheno%>%
filter(Year=="2015")%>%
group_by(species, Individual_ID, Phenophase_Description)%>%
arrange(Individual_ID) %>%
filter(row_number()==1) %>%
spread(Phenophase_Description, First_Yes_DOY)
y0<-na.omit(y0)
y0$Risk <- y0$Leaves - y0$Budburst
y0<-filter(y0, Risk > 0)
y0<-filter(y0, Risk < 31)
y1<-pheno%>%
filter(Year=="2016")%>%
group_by(species, Individual_ID, Phenophase_Description)%>%
arrange(Individual_ID) %>%
filter(row_number()==1) %>%
spread(Phenophase_Description, First_Yes_DOY)
y1<-na.omit(y1)
y1$Risk <- y1$Leaves - y1$Budburst
y1<-filter(y1, Risk > 0)
y1<-filter(y1, Risk < 31)
dat<-full_join(y0,y1)
bud<- dat %>%
select(species, Budburst) %>%
group_by(species)%>%
summarise_each(funs(mean), Budburst) %>%
arrange(species)
leaves<- dat %>%
select(species, Leaves) %>%
group_by(species)%>%
summarise_each(funs(mean), Leaves) %>%
arrange(species)
basic<- full_join(bud, leaves)
basic$Risk<- basic$Leaves - basic$Budburst
ggplot((basic), aes(x=Budburst, y=species)) + geom_point(aes(x= basic$Budburst)) +
geom_segment(aes(y = species, yend = species, x = Budburst, xend = Leaves)) +
geom_point(aes(x=basic$Leaves)) + theme(legend.position="none") +
geom_point(position = position_dodge(.5)) + geom_point(aes(col=species)) + xlab("Budburst to Leaf Out") +
ylab("Species")
bud<- y0 %>%
select(species, Budburst) %>%
group_by(species)%>%
summarise_each(funs(mean), Budburst) %>%
arrange(species)
leaves<- y0 %>%
select(species, Leaves) %>%
group_by(species)%>%
summarise_each(funs(mean), Leaves) %>%
arrange(species)
basic<- full_join(bud, leaves)
basic$Risk<- basic$Leaves - basic$Budburst
ggplot((basic), aes(x=Budburst, y=species)) + geom_point(aes(x= basic$Budburst)) +
geom_segment(aes(y = species, yend = species, x = Budburst, xend = Leaves)) +
geom_point(aes(x=basic$Leaves)) + theme(legend.position="none") +
geom_point(position = position_dodge(.5)) + geom_point(aes(col=species)) + xlab("Budburst to Leaf Out") +
ylab("Species")
pheno<-phenology%>%
select(Site_ID, Genus, Species, Individual_ID, Phenophase_Description, First_Yes_DOY, First_Yes_Year, Latitude, Longitude) %>%
unite(species, Genus, Species, sep="_") %>%
filter(Phenophase_Description %in% phases) %>%
filter(Site_ID == 2) %>%
rename(Year = First_Yes_Year)
y0<-pheno%>%
filter(Year=="2015")%>%
group_by(species, Individual_ID, Phenophase_Description)%>%
arrange(Individual_ID) %>%
filter(row_number()==1) %>%
spread(Phenophase_Description, First_Yes_DOY)
y0<-na.omit(y0)
y0$Risk <- y0$Leaves - y0$Budburst
y0<-filter(y0, Risk > 0)
y0<-filter(y0, Risk < 31)
bud<- y0 %>%
select(species, Budburst) %>%
group_by(species)%>%
summarise_each(funs(mean), Budburst) %>%
arrange(species)
leaves<- y0 %>%
select(species, Leaves) %>%
group_by(species)%>%
summarise_each(funs(mean), Leaves) %>%
arrange(species)
basic<- full_join(bud, leaves)
basic$Risk<- basic$Leaves - basic$Budburst
ggplot((basic), aes(x=Budburst, y=species)) + geom_point(aes(x= basic$Budburst)) +
geom_segment(aes(y = species, yend = species, x = Budburst, xend = Leaves)) +
geom_point(aes(x=basic$Leaves)) + theme(legend.position="none") +
geom_point(position = position_dodge(.5)) + geom_point(aes(col=species)) + xlab("Budburst to Leaf Out") +
ylab("Species")
ggplot((basic), aes(x=Budburst, y=species)) + geom_point(aes(x= basic$Budburst)) +
geom_segment(aes(y = species, yend = species, x = Budburst, xend = Leaves)) +
geom_point(aes(x=basic$Leaves)) + theme(legend.position="none") + geom_point(aes(col=species)) + xlab("Budburst to Leaf Out") +
ylab("Species")
fx <- function(weather, 0, n){
warm <- rle(weather >0)
sum(warm$lengths[warm$values]==n)
}
rm(list=ls()) # remove everything currently held in the R memory
options(stringsAsFactors=FALSE)
graphics.off()
# Load libraries
library(dplyr)
library(tidyr)
library(ggplot2)
library(lubridate)
# Set Working Directory
setwd("~/Documents/git/springfreeze")
weather<-read.csv("input/WeatherData.csv",header=TRUE)
weather<- weather %>%
filter(Site == "hf") %>%
filter(Year > 2000) %>%
filter(JD > 60) %>%
filter(JD < 181)
for(i in unique(budburst$year)){ # i = '2000'
dxx <- budburst[budburst$year == i,]
lox <- rank(dxx$l75.jd)
lox[is.na(dxx$l75.jd)] = NA
box <- rank(dxx$bb.jd, na.last = TRUE)
box[is.na(dxx$bb.jd)] = NA
lo = c(lo, lox)
bb = c(bb, box)
sp = c(sp, dxx$sp)
yr = c(yr, rep(i, nrow(dxx)))
}
fx <- function(weather, 0, n){
warm <- rle(weather >0)
sum(warm$lengths[warm$values]==n)
}
fx <- function(weather, 0, 7){
warm <- rle(weather >0)
sum(warm$AirT[warm$AirT]==7)
}
fx <- function(weather, AirT, 0){
warm <- rle(weather$AirT >0)
sum(warm$AirT[warm$AirT]==7)
}
fx <- function(weather, AirT, n){
warm <- rle(weather$AirT >0)
sum(warm$AirT[warm$AirT]==7)
}
for(i in unique(weather$AirT)){
ifelse(fx > 7)
}
warm.table<-as.data.frame(table(rle(weather$AirT > 0)))
View(warm.table)
fx <- function(weather, AirT, n){
warm <- rle(weather$AirT >0)
}
View(fx)
head(fx)
fx <- function(weather, AirT, n){
warm <- rle(weather$AirT >0)
gdd<-lengths(rle >= 7)
}
gdd<-lengths(warm>=7)
warm<-rle(weather$AirT > 0)
gdd<-lengths(warm>7)
gdd<-ifelse(warm>7)
warm<-as.data.frame(rle(weather$AirT > 0))
warm<-as.data.frame(table(rle(weather$AirT > 0)))
View(warm)
gdd<-ifelse(warm>7, spring, NA)
gdd<-ifelse(warm$lengths >= 7, spring, NA)
gdd<-ifelse(warm$lengths > 7, spring, NA)
gdd<-as.data.frame(table(ifelse(warm$lengths >= 7, spring, NA))
)
View(gdd)
gdd<-as.data.frame(table(ifelse(warm$lengths >= 7)))
gdd<-filter(warm, lengths >= 7)
gdd<-filter(warm, lengths >= "7")
gdd<-filter(warm, values = "TRUE")
gdd<-filter(warm, values == "TRUE")
gdd<- warm %>%
filter(values == "TRUE") %>%
filter(lengths >= "7")
gdd<- warm %>%
filter(values == "TRUE") %>%
filter(lengths >= 7)
gdd<- warm %>%
filter(values == "TRUE") %>%
filter(lengths > 7)
gdd<- warm %>%
filter(values == "TRUE") %>%
filter(warm$lengths >= 7)
gdd<-filter(gdd, warm$lengths >= 7)
View(gdd)
gdd<- warm %>%
filter(values == "TRUE")
View(gdd)
gdd<- gdd %>%
select(lengths, Freq) %>%
rename(days = lengths) %>%
rename(times = Freq)
gdd<- gdd %>%
select(lengths, Freq) %>%
rename(days = lengths) %>%
rename(times = Freq) %>%
filter(days >= 7)
gdd<- gdd %>%
select(lengths, Freq) %>%
rename(days = lengths) %>%
rename(times = Freq)
View(gdd)
setwd("~/Documents/git/springfreeze")
weather<-read.csv("input/WeatherData.csv",header=TRUE)
# Subset Weather down for HF
weather<- weather %>%
filter(Site == "hf") %>%
filter(Year > 2000) %>%
filter(JD > 60) %>%
filter(JD < 181)
warm<-as.data.frame(table(rle(weather$AirT > 0)))
gdd<- warm %>%
filter(values == "TRUE")
gdd<- gdd %>%
select(lengths, Freq) %>%
rename(days = lengths) %>%
rename(times = Freq) %>%
filter(days>=7)
gdd<- gdd %>%
select(lengths, Freq) %>%
rename(days = lengths) %>%
rename(times = Freq)
gdd<- warm %>%
filter(values == "TRUE")
gdd<- gdd %>%
select(lengths, Freq) %>%
rename(days = lengths) %>%
rename(times = Freq)
View(gdd)
gdd<- warm %>%
filter(values == "TRUE")
gdd<- gdd %>%
select(lengths, Freq) %>%
rename(days = lengths) %>%
rename(times = Freq) %>%
filter(days > 0)
fx <- function(weather, AirT, n){
warm <- rle(weather$AirT >0)
gdd<-warm$lengths>= 7
}
gdd.table<-as.data.frame(table(warm$lengths>7))
View(gdd.table)
for(i in unique(weather)){
ifelse(fx$lengths > 7)
}
for(i in unique(weather$AirTMin)){
dxx<-weather[weather$year == i,]
warm<-rle(weather$AirT > 0)
warm[is.na(dxx$AirT)] = NA
gdd<-identify(warm$AirT>=7)
gdd[is.na(dxx$AirT)] = NA
frz<-ifelse(gdd>0, x, NA)
year = c(year, rep(i, nrow(dxx)))
}
View(dxx)
for(i in unique(weather$AirTMin)){
dxx<-weather[weather$year == i,]
dxx$warm<-rle(weather$AirT > 0)
dxx$warm[is.na(dxx$AirT)] = NA
dxx$gdd<-identify(warm$AirT>=7)
dxx$gdd[is.na(dxx$AirT)] = NA
dxx$frz<-ifelse(gdd>0, Y, NA)
}
for(i in unique(weather$AirTMin)){
dxx<-weather[weather$year == i,]
dxx$warm<-rle(weather$AirT > 0)
dxx$warm[is.na(dxx$AirT)] = NA
dxx$gdd<-identify(warm$AirT>=7)
dxx$gdd[is.na(dxx$AirT)] = NA
dxx$frz<-ifelse(gdd>0, Y, NA)
yr = c(yr, rep(i, nrow(dxx)))
}
for(i in unique(weather$AirTMin)){
dxx<-weather[weather$year == i,]
dxx$warm<-rle(weather$AirT > 0)
dxx$warm[is.na(dxx$AirT)] = NA
dxx$frz<-ifelse(gdd>0, Y, NA)
yr = c(yr, rep(i, nrow(dxx)))
}
for(i in unique(weather$AirTMin)){
dxx<-weather[weather$year == i,]
dxx$warm<-rle(weather$AirT > 0)
dxx$warm[is.na(dxx$AirT)] = NA
dxx$frz<-ifelse(weather$AirTMin<0, Y, NA)
yr = c(yr, rep(i, nrow(dxx)))
}
