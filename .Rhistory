dflong<- tidyr::gather(dftot, var, value, force:`photo:chill2`, factor_key=TRUE)
for (i in seq(from=1,to=nrow(dflong), by=30)) {
for (j in seq(from=3, to=29, by=1)) {
dflong$value[i+j]<- as.numeric(dflong$value[i+j]) + as.numeric(dflong$value[i])
}
}
dflong$rndm<-ifelse(dftot$sp>0, 2, 1)
dfwide<-tidyr::spread(dflong, perc, value)
dfwide[,4:6] <- as.data.frame(lapply(c(dfwide[,4:6]), as.numeric ))
dfwide$sp<-as.factor(dfwide$sp)
pd <- position_dodgev(height = -0.5)
estimates<-c("Forcing", "Photoperiod", "Chilling 1.5°C", "Chilling 4°C", "Forcing x Photoperiod",
"Forcing x Chilling 1.5°C", "Forcing x Chilling 4°C", "Photoperiod x Chilling 1.5°C",
"Photoperiod x Chilling 4°C")
View(dfwide)
dfwide$legend<-factor(dfwide$sp,
labels=c("Overall Effects","1","2","3","4","5","6","7","9"))
dfwide$legend<-factor(dfwide$sp,
labels=c("Overall Effects","1","2","3","4","5","6","7","8","9"))
estimates<-rev(estimates)
fig1 <-ggplot(dfwide, aes(x=Estimate, y=var, color=legend, size=factor(rndm), alpha=factor(rndm)))+
geom_point(position =pd)+
geom_errorbarh(aes(xmin=(`2.5%`), xmax=(`95%`)), position=pd, size=.5, height =0, width=0)+
geom_vline(xintercept=0)+
scale_colour_manual(values=c("blue", "firebrick3", "orangered1","orange3", "sienna4","sienna2", "green4", "green3", "purple2", "magenta3"),
breaks=c("Overall Effects"))+
scale_size_manual(values=c(3, 1, 1, 1, 1, 1, 1, 1, 1, 1)) +
scale_shape_manual(labels="", values=c("1"=16,"2"=16))+
scale_alpha_manual(values=c(1, 0.4)) +
guides(size=FALSE, alpha=FALSE) + #removes the legend
ggtitle(label = "A.")+
scale_y_discrete(limits = rev(unique(sort(dfwide$var))), labels=estimates) + ylab("") +
labs(col="Effects") + theme(legend.position = c(0.15, 0.01), legend.title=element_blank())
fig1
fig1 <-ggplot(dfwide, aes(x=Estimate, y=var, color=legend, size=factor(rndm), alpha=factor(rndm)))+
geom_point(position =pd)+
geom_errorbarh(aes(xmin=(`2.5%`), xmax=(`95%`)), position=pd, size=.5, height =0, width=0)+
geom_vline(xintercept=0)+
scale_colour_manual(values=c("blue", "firebrick3", "orangered1","orange3", "sienna4","sienna2", "green4", "green3", "purple2", "magenta3"),
breaks=c("Overall Effects"))+
scale_size_manual(values=c(3, 1, 1, 1, 1, 1, 1, 1, 1, 1)) +
scale_shape_manual(labels="", values=c("1"=16,"2"=16))+
scale_alpha_manual(values=c(1, 0.4)) +
guides(size=FALSE, alpha=FALSE) + #removes the legend
ggtitle(label = "A.")+
scale_y_discrete(limits = rev(unique(sort(dfwide$var))), labels=estimates) + ylab("") +
labs(col="Effects") + theme(legend.position = c(0.15, 0.15), legend.title=element_blank())
fig1
dxx<-read.csv("output/diffplot.csv", header=TRUE)
diff<-ggplot(dxx, aes(x=factor(code), y=diff, col=factor(code))) + geom_point() +
geom_linerange(aes(ymin=diff-diff.sd, ymax=diff+diff.sd), alpha=0.3) +
ylab(expression(atop(Delta*" in Duration of Vegetative Risk", paste("Between Treatments (days)")))) + coord_cartesian(ylim=c(0,25)) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.title.x=element_blank(),
axis.text.x = element_text(face = "italic", angle=45, hjust=1),
axis.text=element_text(size=10), legend.position = "none") +
scale_colour_manual(values=c("firebrick3", "orangered1","orange3", "sienna4","sienna2", "green4", "green3", "purple2", "magenta3")) +
ggtitle(label="B.")
plot(diff)
ggarrange(fig1, diff, ncol=2)
diff<-ggplot(dxx, aes(x=factor(code), y=diff, col=factor(code))) + geom_point() +
geom_linerange(aes(ymin=diff-diff.sd, ymax=diff+diff.sd), alpha=0.3) +
ylab(expression(atop(Delta*" in Duration of Vegetative Risk", paste("Between Treatments (days)")))) + coord_cartesian(ylim=c(0,25)) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.title.x=element_blank(),
axis.text.x = element_text(face = "italic", angle=45, hjust=1),
axis.text=element_text(size=10), legend.position = "none") +
scale_colour_manual(values=c("firebrick3", "orangered1","orange3", "sienna4","sienna2", "green4", "green3", "purple2", "magenta3")) +
ggtitle(label="B.")
plot(diff)
plot(diff)
ggarrange(fig1, diff, ncol=2)
ggarrange(fig1, diff, ncol=2)
fig1 <-ggplot(dfwide, aes(x=Estimate, y=var, color=legend, size=factor(rndm), alpha=factor(rndm)))+
geom_point(position =pd)+
geom_errorbarh(aes(xmin=(`2.5%`), xmax=(`95%`)), position=pd, size=.5, height =0, width=0)+
geom_vline(xintercept=0)+
scale_colour_manual(values=c("blue", "firebrick3", "orangered1","orange3", "sienna4","sienna2", "green4", "green3", "purple2", "magenta3"),
breaks=c("Overall Effects"))+
scale_size_manual(values=c(3, 1, 1, 1, 1, 1, 1, 1, 1, 1)) +
scale_shape_manual(labels="", values=c("1"=16,"2"=16))+
scale_alpha_manual(values=c(1, 0.4)) +
guides(size=FALSE, alpha=FALSE) + #removes the legend
ggtitle(label = "A.")+
scale_y_discrete(limits = rev(unique(sort(dfwide$var))), labels=estimates) + ylab("") +
labs(col="Effects") + theme(legend.position = c(0.95, 0.85))
ggarrange(fig1, diff, ncol=2)
ggarrange(fig1, diff, ncol=2)
ggarrange(fig1, diff, ncol=2)
fig1 <-ggplot(dfwide, aes(x=Estimate, y=var, color=legend, size=factor(rndm), alpha=factor(rndm)))+
geom_point(position =pd)+
geom_errorbarh(aes(xmin=(`2.5%`), xmax=(`95%`)), position=pd, size=.5, height =0, width=0)+
geom_vline(xintercept=0)+
scale_colour_manual(values=c("blue", "firebrick3", "orangered1","orange3", "sienna4","sienna2", "green4", "green3", "purple2", "magenta3"),
breaks=c("Overall Effects"))+
scale_size_manual(values=c(3, 1, 1, 1, 1, 1, 1, 1, 1, 1)) +
scale_shape_manual(labels="", values=c("1"=16,"2"=16))+
scale_alpha_manual(values=c(1, 0.4)) +
guides(size=FALSE, alpha=FALSE) + #removes the legend
ggtitle(label = "A.")+
scale_y_discrete(limits = rev(unique(sort(dfwide$var))), labels=estimates) + ylab("") +
labs(col="Effects") + theme(legend.position = c(0.15, 0.15), legend.box.background = element_rect(), legend.title=element_blank())
fig1
ggarrange(fig1, diff, ncol=2)
ggarrange(fig1, diff, ncol=2)
ggarrange(fig1, diff, ncol=2)
ggarrange(fig1, diff, ncol=2)
fig1 <-ggplot(dfwide, aes(x=Estimate, y=var, color=legend, size=factor(rndm), alpha=factor(rndm)))+
geom_point(position =pd)+
geom_errorbarh(aes(xmin=(`2.5%`), xmax=(`95%`)), position=pd, size=.5, height =0, width=0)+
geom_vline(xintercept=0)+
scale_colour_manual(values=c("blue", "firebrick3", "orangered1","orange3", "sienna4","sienna2", "green4", "green3", "purple2", "magenta3"),
breaks=c("Overall Effects"))+
scale_size_manual(values=c(3, 1, 1, 1, 1, 1, 1, 1, 1, 1)) +
scale_shape_manual(labels="", values=c("1"=16,"2"=16))+
scale_alpha_manual(values=c(1, 0.4)) +
guides(size=FALSE, alpha=FALSE) + #removes the legend
ggtitle(label = "A.")+
scale_y_discrete(limits = rev(unique(sort(dfwide$var))), labels=estimates) + ylab("") +
labs(col="Effects") + theme(legend.position = c(0.25, 0.10), legend.box.background = element_rect(), legend.title=element_blank())
fig1
ggarrange(fig1, diff, ncol=2)
fig1 <-ggplot(dfwide, aes(x=Estimate, y=var, color=legend, size=factor(rndm), alpha=factor(rndm)))+
geom_point(position =pd)+
geom_errorbarh(aes(xmin=(`2.5%`), xmax=(`95%`)), position=pd, size=.5, height =0, width=0)+
geom_vline(xintercept=0)+
scale_colour_manual(values=c("blue", "firebrick3", "orangered1","orange3", "sienna4","sienna2", "green4", "green3", "purple2", "magenta3"),
breaks=c("Overall Effects"))+
scale_size_manual(values=c(3, 1, 1, 1, 1, 1, 1, 1, 1, 1)) +
scale_shape_manual(labels="", values=c("1"=16,"2"=16))+
scale_alpha_manual(values=c(1, 0.4)) +
guides(size=FALSE, alpha=FALSE) + #removes the legend
ggtitle(label = "A.")+
scale_y_discrete(limits = rev(unique(sort(dfwide$var))), labels=estimates) + ylab("") +
labs(col="Effects") + theme(legend.position = c(0.75, 0.90), legend.box.background = element_rect(), legend.title=element_blank())
fig1
fig1 <-ggplot(dfwide, aes(x=Estimate, y=var, color=legend, size=factor(rndm), alpha=factor(rndm)))+
geom_point(position =pd)+
geom_errorbarh(aes(xmin=(`2.5%`), xmax=(`95%`)), position=pd, size=.5, height =0, width=0)+
geom_vline(xintercept=0)+
scale_colour_manual(values=c("blue", "firebrick3", "orangered1","orange3", "sienna4","sienna2", "green4", "green3", "purple2", "magenta3"),
breaks=c("Overall Effects"))+
scale_size_manual(values=c(3, 1, 1, 1, 1, 1, 1, 1, 1, 1)) +
scale_shape_manual(labels="", values=c("1"=16,"2"=16))+
scale_alpha_manual(values=c(1, 0.4)) +
guides(size=FALSE, alpha=FALSE) + #removes the legend
ggtitle(label = "A.")+
scale_y_discrete(limits = rev(unique(sort(dfwide$var))), labels=estimates) + ylab("") +
labs(col="Effects") + theme(legend.position = c(0.80, 0.90), legend.box.background = element_rect(), legend.title=element_blank())
fig1
ggarrange(fig1, diff, ncol=2)
fig1 <-ggplot(dfwide, aes(x=Estimate, y=var, color=legend, size=factor(rndm), alpha=factor(rndm)))+
geom_point(position =pd)+
geom_errorbarh(aes(xmin=(`2.5%`), xmax=(`95%`)), position=pd, size=.5, height =0, width=0)+
geom_vline(xintercept=0)+
scale_colour_manual(values=c("blue", "firebrick3", "orangered1","orange3", "sienna4","sienna2", "green4", "green3", "purple2", "magenta3"),
breaks=c("Overall Effects"))+
scale_size_manual(values=c(3, 1, 1, 1, 1, 1, 1, 1, 1, 1)) +
scale_shape_manual(labels="", values=c("1"=16,"2"=16))+
scale_alpha_manual(values=c(1, 0.4)) +
guides(size=FALSE, alpha=FALSE) + #removes the legend
ggtitle(label = "A.")+
scale_y_discrete(limits = rev(unique(sort(dfwide$var))), labels=estimates) + ylab("") +
labs(col="Effects") + theme(legend.position = c(0.90, 0.95), legend.box.background = element_rect(), legend.title=element_blank())
ggarrange(fig1, diff, ncol=2)
fig1 <-ggplot(dfwide, aes(x=Estimate, y=var, color=legend, size=factor(rndm), alpha=factor(rndm)))+
geom_point(position =pd)+
geom_errorbarh(aes(xmin=(`2.5%`), xmax=(`95%`)), position=pd, size=.5, height =0, width=0)+
geom_vline(xintercept=0)+
scale_colour_manual(values=c("blue", "firebrick3", "orangered1","orange3", "sienna4","sienna2", "green4", "green3", "purple2", "magenta3"),
breaks=c("Overall Effects"))+
scale_size_manual(values=c(3, 1, 1, 1, 1, 1, 1, 1, 1, 1)) +
scale_shape_manual(labels="", values=c("1"=16,"2"=16))+
scale_alpha_manual(values=c(1, 0.4)) +
guides(size=FALSE, alpha=FALSE) + #removes the legend
ggtitle(label = "A.")+
scale_y_discrete(limits = rev(unique(sort(dfwide$var))), labels=estimates) + ylab("") +
labs(col="Effects") + theme(legend.position = c(0.90, 0.95), legend.box.background = element_rect(),
legend.title=element_blank(), legend.key.size = unit(cm, "1"))
fig1 <-ggplot(dfwide, aes(x=Estimate, y=var, color=legend, size=factor(rndm), alpha=factor(rndm)))+
geom_point(position =pd)+
geom_errorbarh(aes(xmin=(`2.5%`), xmax=(`95%`)), position=pd, size=.5, height =0, width=0)+
geom_vline(xintercept=0)+
scale_colour_manual(values=c("blue", "firebrick3", "orangered1","orange3", "sienna4","sienna2", "green4", "green3", "purple2", "magenta3"),
breaks=c("Overall Effects"))+
scale_size_manual(values=c(3, 1, 1, 1, 1, 1, 1, 1, 1, 1)) +
scale_shape_manual(labels="", values=c("1"=16,"2"=16))+
scale_alpha_manual(values=c(1, 0.4)) +
guides(size=FALSE, alpha=FALSE) + #removes the legend
ggtitle(label = "A.")+
scale_y_discrete(limits = rev(unique(sort(dfwide$var))), labels=estimates) + ylab("") +
labs(col="Effects") + theme(legend.position = c(0.90, 0.95), legend.box.background = element_rect(),
legend.title=element_blank(), legend.key.size = unit(0.3, "cm"))
fig1
ggarrange(fig1, diff, ncol=2)
fig1 <-ggplot(dfwide, aes(x=Estimate, y=var, color=legend, size=factor(rndm), alpha=factor(rndm)))+
geom_point(position =pd)+
geom_errorbarh(aes(xmin=(`2.5%`), xmax=(`95%`)), position=pd, size=.5, height =0, width=0)+
geom_vline(xintercept=0)+
scale_colour_manual(values=c("blue", "firebrick3", "orangered1","orange3", "sienna4","sienna2", "green4", "green3", "purple2", "magenta3"),
breaks=c("Overall Effects"))+
scale_size_manual(values=c(3, 1, 1, 1, 1, 1, 1, 1, 1, 1)) +
scale_shape_manual(labels="", values=c("1"=16,"2"=16))+
scale_alpha_manual(values=c(1, 0.4)) +
guides(size=FALSE, alpha=FALSE) + #removes the legend
ggtitle(label = "A.")+
scale_y_discrete(limits = rev(unique(sort(dfwide$var))), labels=estimates) + ylab("") +
labs(col="Effects") + theme(legend.position = c(0.90, 0.95), legend.box.background = element_rect(),
legend.title=element_blank(), legend.key.size = unit(0.15, "cm"))
fig1
ggarrange(fig1, diff, ncol=2)
ggarrange(fig1, diff, ncol=2)
ggarrange(fig1, diff, ncol=2)
fig1 <-ggplot(dfwide, aes(x=Estimate, y=var, color=legend, size=factor(rndm), alpha=factor(rndm)))+
geom_point(position =pd)+
geom_errorbarh(aes(xmin=(`2.5%`), xmax=(`95%`)), position=pd, size=.5, height =0, width=0)+
geom_vline(xintercept=0)+
scale_colour_manual(values=c("blue", "firebrick3", "orangered1","orange3", "sienna4","sienna2", "green4", "green3", "purple2", "magenta3"),
breaks=c("Overall Effects"))+
scale_size_manual(values=c(3, 1, 1, 1, 1, 1, 1, 1, 1, 1)) +
scale_shape_manual(labels="", values=c("1"=16,"2"=16))+
scale_alpha_manual(values=c(1, 0.4)) +
guides(size=FALSE, alpha=FALSE) + #removes the legend
ggtitle(label = "A.")+
scale_y_discrete(limits = rev(unique(sort(dfwide$var))), labels=estimates) + ylab("") +
labs(col="Effects") + theme(legend.position = c(0.90, 0.95), legend.box.background = element_rect(),
legend.title=element_blank(), legend.key.size = unit(0.2, "cm"))
fig1
fig1 <-ggplot(dfwide, aes(x=Estimate, y=var, color=legend, size=factor(rndm), alpha=factor(rndm)))+
geom_point(position =pd)+
geom_errorbarh(aes(xmin=(`2.5%`), xmax=(`95%`)), position=pd, size=.5, height =0, width=0)+
geom_vline(xintercept=0)+
scale_colour_manual(values=c("blue", "firebrick3", "orangered1","orange3", "sienna4","sienna2", "green4", "green3", "purple2", "magenta3"),
breaks=c("Overall Effects"))+
scale_size_manual(values=c(3, 1, 1, 1, 1, 1, 1, 1, 1, 1)) +
scale_shape_manual(labels="", values=c("1"=16,"2"=16))+
scale_alpha_manual(values=c(1, 0.4)) +
guides(size=FALSE, alpha=FALSE) + #removes the legend
ggtitle(label = "A.")+
scale_y_discrete(limits = rev(unique(sort(dfwide$var))), labels=estimates) + ylab("") +
labs(col="Effects") + theme(legend.position = c(0.85, 0.90), legend.box.background = element_rect(),
legend.title=element_blank(), legend.key.size = unit(0.2, "cm"))
ggarrange(fig1, diff, ncol=2)
fig1 <-ggplot(dfwide, aes(x=Estimate, y=var, color=legend, size=factor(rndm), alpha=factor(rndm)))+
geom_point(position =pd)+
geom_errorbarh(aes(xmin=(`2.5%`), xmax=(`95%`)), position=pd, size=.5, height =0, width=0)+
geom_vline(xintercept=0)+
scale_colour_manual(values=c("blue", "firebrick3", "orangered1","orange3", "sienna4","sienna2", "green4", "green3", "purple2", "magenta3"),
breaks=c("Overall Effects"))+
scale_size_manual(values=c(3, 1, 1, 1, 1, 1, 1, 1, 1, 1)) +
scale_shape_manual(labels="", values=c("1"=16,"2"=16))+
scale_alpha_manual(values=c(1, 0.4)) +
guides(size=FALSE, alpha=FALSE) + #removes the legend
ggtitle(label = "A.")+
scale_y_discrete(limits = rev(unique(sort(dfwide$var))), labels=estimates) + ylab("") +
labs(col="Effects") + theme(legend.position = c(0.10, 0.15), legend.box.background = element_rect(),
legend.title=element_blank(), legend.key.size = unit(0.2, "cm"))
fig1
fig1 <-ggplot(dfwide, aes(x=Estimate, y=var, color=legend, size=factor(rndm), alpha=factor(rndm)))+
geom_point(position =pd)+
geom_errorbarh(aes(xmin=(`2.5%`), xmax=(`95%`)), position=pd, size=.5, height =0, width=0)+
geom_vline(xintercept=0)+
scale_colour_manual(values=c("blue", "firebrick3", "orangered1","orange3", "sienna4","sienna2", "green4", "green3", "purple2", "magenta3"),
breaks=c("Overall Effects"))+
scale_size_manual(values=c(3, 1, 1, 1, 1, 1, 1, 1, 1, 1)) +
scale_shape_manual(labels="", values=c("1"=16,"2"=16))+
scale_alpha_manual(values=c(1, 0.4)) +
guides(size=FALSE, alpha=FALSE) + #removes the legend
ggtitle(label = "A.")+
scale_y_discrete(limits = rev(unique(sort(dfwide$var))), labels=estimates) + ylab("") +
labs(col="Effects") + theme(legend.position = c(0.15, 0.15), legend.box.background = element_rect(),
legend.title=element_blank(), legend.key.size = unit(0.2, "cm"))
fig1
ggarrange(fig1, diff, ncol=2)
fig1 <-ggplot(dfwide, aes(x=Estimate, y=var, color=legend, size=factor(rndm), alpha=factor(rndm)))+
geom_point(position =pd)+
geom_errorbarh(aes(xmin=(`2.5%`), xmax=(`95%`)), position=pd, size=.5, height =0, width=0)+
geom_vline(xintercept=0)+
scale_colour_manual(values=c("blue", "firebrick3", "orangered1","orange3", "sienna4","sienna2", "green4", "green3", "purple2", "magenta3"),
breaks=c("Overall Effects"))+
scale_size_manual(values=c(3, 1, 1, 1, 1, 1, 1, 1, 1, 1)) +
scale_shape_manual(labels="", values=c("1"=16,"2"=16))+
scale_alpha_manual(values=c(1, 0.4)) +
guides(size=FALSE, alpha=FALSE) + #removes the legend
ggtitle(label = "A.")+
scale_y_discrete(limits = rev(unique(sort(dfwide$var))), labels=estimates) + ylab("") +
labs(col="Effects") + theme(legend.position = c(0.15, 0.15), legend.box.background = element_rect(),
legend.title=element_blank(), legend.key.size = unit(0.05, "cm"))
fig1
ggarrange(fig1, diff, ncol=2)
source('~/Documents/git/springfreeze/scripts/stan/StanCode_DVR.R', echo=TRUE)
ggarrange(fig1, diff, ncol=2)
library(ggplot2)
library(rstan)
library(rstanarm)
library(shinystan)
library(bayesplot)
library(dplyr)
library(gridExtra)
library(brms)
library(egg)
library(ggstance)
setwd("~/Documents/git/springfreeze/")
source('scripts/stan/savestan.R')
dx<-read.csv("output/danfdata.csv", header=TRUE)
dx$sp <- as.numeric(as.factor(dx$sp))
dx<-dx[!is.na(dx$risk),]
levels(dx$warm) = c(0,1); levels(dx$photo) = c(0, 1); levels(dx$chill) = 1:3
dx$warm <- as.numeric(dx$warm)
dx$warm<-ifelse(dx$warm==15, 0, 1)
dx$photo <- as.numeric(dx$photo)
dx$photo<-ifelse(dx$photo==8, 0, 1)
dx$chill <- as.numeric(dx$chill)
dx$chill1 = ifelse(dx$chill == 1, 1, 0)
dx$chill2 = ifelse(dx$chill == 2, 1, 0)
dxb <- dx[!is.na(dx$risk),]
dxb<-filter(dxb, risk>0)
dxb$force<-dxb$warm
fit.brm<-brm(risk~ force + photo + chill1 + chill2 + force:photo + force:chill1 +
force:chill2 + photo:chill1 + photo:chill2 + (1|sp) + (force-1|sp) + (photo-1|sp)
+ (chill1-1|sp) + (chill2-1|sp) + (force:photo-1|sp) +
(force:chill1-1|sp) + (force:chill2-1|sp) + (photo:chill1-1|sp) +
(photo:chill2-1|sp), data=dxb)
m<-fit.brm
m.int<-posterior_interval(m)
sum.m<-summary(m)
cri.f<-as.data.frame(sum.m$fixed[,c("Estimate", "l-95% CI", "u-95% CI")])
cri.f<-cri.f[-1,] #removing the intercept
fdf1<-as.data.frame(rbind(as.vector(cri.f[,1]), as.vector(cri.f[,2]), as.vector(cri.f[,3])))
fdf2<-cbind(fdf1, c(0, 0, 0) , c("Estimate", "2.5%", "95%"))
names(fdf2)<-c(rownames(cri.f), "sp", "perc")
cri.r<-(ranef(m, summary = TRUE, robust = FALSE,
probs = c(0.025, 0.975)))$sp
cri.r2<-cri.r[, ,-1]
cri.r2<-cri.r2[,-2,]
dims<-dim(cri.r2)
twoDimMat <- matrix(cri.r2, prod(dims[1:2]), dims[3])
mat2<-cbind(twoDimMat, c(rep(1:9, length.out=27)), rep(c("Estimate", "2.5%", "95%"), each=9))
df<-as.data.frame(mat2)
names(df)<-c(rownames(cri.f), "sp", "perc")
dftot<-rbind(fdf2, df)
dflong<- tidyr::gather(dftot, var, value, force:`photo:chill2`, factor_key=TRUE)
for (i in seq(from=1,to=nrow(dflong), by=30)) {
for (j in seq(from=3, to=29, by=1)) {
dflong$value[i+j]<- as.numeric(dflong$value[i+j]) + as.numeric(dflong$value[i])
}
}
dflong$rndm<-ifelse(dftot$sp>0, 2, 1)
dfwide<-tidyr::spread(dflong, perc, value)
dfwide[,4:6] <- as.data.frame(lapply(c(dfwide[,4:6]), as.numeric ))
dfwide$sp<-as.factor(dfwide$sp)
pd <- position_dodgev(height = -0.5)
estimates<-c("Forcing", "Photoperiod", "Chilling 1.5°C", "Chilling 4°C", "Forcing x Photoperiod",
"Forcing x Chilling 1.5°C", "Forcing x Chilling 4°C", "Photoperiod x Chilling 1.5°C",
"Photoperiod x Chilling 4°C")
dfwide$legend<-factor(dfwide$sp,
labels=c("Overall Effects","1","2","3","4","5","6","7","8","9"))
estimates<-rev(estimates)
fig1 <-ggplot(dfwide, aes(x=Estimate, y=var, color=legend, size=factor(rndm), alpha=factor(rndm)))+
geom_point(position =pd)+
geom_errorbarh(aes(xmin=(`2.5%`), xmax=(`95%`)), position=pd, size=.5, height =0, width=0)+
geom_vline(xintercept=0)+
scale_colour_manual(values=c("blue", "firebrick3", "orangered1","orange3", "sienna4","sienna2", "green4", "green3", "purple2", "magenta3"),
breaks=c("Overall Effects"))+
scale_size_manual(values=c(3, 1, 1, 1, 1, 1, 1, 1, 1, 1)) +
scale_shape_manual(labels="", values=c("1"=16,"2"=16))+
scale_alpha_manual(values=c(1, 0.4)) +
guides(size=FALSE, alpha=FALSE) + #removes the legend
ggtitle(label = "A.")+
scale_y_discrete(limits = rev(unique(sort(dfwide$var))), labels=estimates) + ylab("") +
labs(col="Effects") + theme(legend.position = c(0.15, 0.15), legend.box.background = element_rect(),
legend.title=element_blank(), legend.key.size = unit(0.05, "cm"))
write.csv(dfwide, file="~/Documents/git/springfreeze/output/df_modforplot.csv", row.names=FALSE)
fig1 <-ggplot(dfwide, aes(x=Estimate, y=var, color=legend, size=factor(rndm), alpha=factor(rndm)))+
geom_point(position =pd)+
geom_errorbarh(aes(xmin=(`2.5%`), xmax=(`95%`)), position=pd, size=.5, height =0, width=0)+
geom_vline(xintercept=0)+
scale_colour_manual(values=c("blue", "firebrick3", "orangered1","orange3", "sienna4","sienna2", "green4", "green3", "purple2", "magenta3"),
breaks=c("Overall Effects"))+
scale_size_manual(values=c(3, 1, 1, 1, 1, 1, 1, 1, 1, 1)) +
scale_shape_manual(labels="", values=c("1"=16,"2"=16))+
scale_alpha_manual(values=c(1, 0.4)) +
guides(size=FALSE, alpha=FALSE) + #removes the legend
ggtitle(label = "A.")+
scale_y_discrete(limits = rev(unique(sort(dfwide$var))), labels=estimates) + ylab("") +
labs(col="Effects") + theme(legend.position = c(0.15, 0.15), legend.box.background = element_rect(),
legend.title=element_blank(), legend.key.size = unit(0.05, "cm"))
fig1
dxx<-read.csv("output/diffplot.csv", header=TRUE)
diff<-ggplot(dxx, aes(x=factor(code), y=diff, col=factor(code))) + geom_point() +
geom_linerange(aes(ymin=diff-diff.sd, ymax=diff+diff.sd), alpha=0.3) +
ylab(expression(atop(Delta*" in Duration of Vegetative Risk", paste("Between Treatments (days)")))) + coord_cartesian(ylim=c(0,25)) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.title.x=element_blank(),
axis.text.x = element_text(face = "italic", angle=45, hjust=1),
axis.text=element_text(size=10), legend.position = "none") +
scale_colour_manual(values=c("firebrick3", "orangered1","orange3", "sienna4","sienna2", "green4", "green3", "purple2", "magenta3")) +
ggtitle(label="B.")
plot(diff)
ggarrange(fig1, diff, ncol=2)
ggarrange(fig1, diff, ncol=2)
fig1 <-ggplot(dfwide, aes(x=Estimate, y=var, color=legend, size=factor(rndm), alpha=factor(rndm)))+
geom_point(position =pd)+
geom_errorbarh(aes(xmin=(`2.5%`), xmax=(`95%`)), position=pd, size=.5, height =0, width=0)+
geom_vline(xintercept=0)+
scale_colour_manual(values=c("blue", "firebrick3", "orangered1","orange3", "sienna4","sienna2", "green4", "green3", "purple2", "magenta3"),
breaks=c("Overall Effects"))+
scale_size_manual(values=c(3, 1, 1, 1, 1, 1, 1, 1, 1, 1)) +
scale_shape_manual(labels="", values=c("1"=16,"2"=16))+
scale_alpha_manual(values=c(1, 0.4)) +
guides(size=FALSE, alpha=FALSE) + #removes the legend
ggtitle(label = "A.")+
scale_y_discrete(limits = rev(unique(sort(dfwide$var))), labels=estimates) + ylab("") +
labs(col="Effects") + theme(legend.position = c(0.25, 0.15), legend.box.background = element_rect(),
legend.title=element_blank(), legend.key.size = unit(0.05, "cm"))
ggarrange(fig1, diff, ncol=2)
ggarrange(fig1, diff, ncol=2)
fig1 <-ggplot(dfwide, aes(x=Estimate, y=var, color=legend, size=factor(rndm), alpha=factor(rndm)))+
geom_point(position =pd)+
geom_errorbarh(aes(xmin=(`2.5%`), xmax=(`95%`)), position=pd, size=.5, height =0, width=0)+
geom_vline(xintercept=0)+
scale_colour_manual(values=c("blue", "firebrick3", "orangered1","orange3", "sienna4","sienna2", "green4", "green3", "purple2", "magenta3"),
breaks=c("Overall Effects"))+
scale_size_manual(values=c(3, 1, 1, 1, 1, 1, 1, 1, 1, 1)) +
scale_shape_manual(labels="", values=c("1"=16,"2"=16))+
scale_alpha_manual(values=c(1, 0.4)) +
guides(size=FALSE, alpha=FALSE) + #removes the legend
ggtitle(label = "A.")+
scale_y_discrete(limits = rev(unique(sort(dfwide$var))), labels=estimates) + ylab("") +
labs(col="Effects") + theme(legend.position = c(0.95, 0.95), legend.box.background = element_rect(),
legend.title=element_blank(), legend.key.size = unit(0.05, "cm"))
ggarrange(fig1, diff, ncol=2)
fig1 <-ggplot(dfwide, aes(x=Estimate, y=var, color=legend, size=factor(rndm), alpha=factor(rndm)))+
geom_point(position =pd)+
geom_errorbarh(aes(xmin=(`2.5%`), xmax=(`95%`)), position=pd, size=.5, height =0, width=0)+
geom_vline(xintercept=0)+
scale_colour_manual(values=c("blue", "firebrick3", "orangered1","orange3", "sienna4","sienna2", "green4", "green3", "purple2", "magenta3"),
breaks=c("Overall Effects"))+
scale_size_manual(values=c(3, 1, 1, 1, 1, 1, 1, 1, 1, 1)) +
scale_shape_manual(labels="", values=c("1"=16,"2"=16))+
scale_alpha_manual(values=c(1, 0.4)) +
guides(size=FALSE, alpha=FALSE) + #removes the legend
ggtitle(label = "A.")+
scale_y_discrete(limits = rev(unique(sort(dfwide$var))), labels=estimates) + ylab("") +
labs(col="Effects") + theme(legend.position = c(0.90, 0.95), legend.box.background = element_rect(),
legend.title=element_blank(), legend.key.size = unit(0.05, "cm"))
ggarrange(fig1, diff, ncol=2)
fig1 <-ggplot(dfwide, aes(x=Estimate, y=var, color=legend, size=factor(rndm), alpha=factor(rndm)))+
geom_point(position =pd)+
geom_errorbarh(aes(xmin=(`2.5%`), xmax=(`95%`)), position=pd, size=.5, height =0, width=0)+
geom_vline(xintercept=0)+
scale_colour_manual(values=c("blue", "firebrick3", "orangered1","orange3", "sienna4","sienna2", "green4", "green3", "purple2", "magenta3"),
breaks=c("Overall Effects"))+
scale_size_manual(values=c(3, 2, 2, 2, 2, 2, 2, 2, 2, 2)) +
scale_shape_manual(labels="", values=c("1"=16,"2"=16))+
scale_alpha_manual(values=c(1, 0.4)) +
guides(size=FALSE, alpha=FALSE) + #removes the legend
ggtitle(label = "A.")+
scale_y_discrete(limits = rev(unique(sort(dfwide$var))), labels=estimates) + ylab("") +
labs(col="Effects") + theme(legend.position = c(0.90, 0.95), legend.box.background = element_rect(),
legend.title=element_blank(), legend.key.size = unit(0.05, "cm"))
fig1
ggarrange(fig1, diff, ncol=2)
fig1 <-ggplot(dfwide, aes(x=Estimate, y=var, color=legend, size=factor(rndm), alpha=factor(rndm)))+
geom_point(position =pd)+
geom_errorbarh(aes(xmin=(`2.5%`), xmax=(`95%`)), position=pd, size=.5, height =0, width=0)+
geom_vline(xintercept=0)+
scale_colour_manual(values=c("blue", "firebrick3", "orangered1","orange3", "sienna4","sienna2", "green4", "green3", "purple2", "magenta3"),
breaks=c("Overall Effects"))+
scale_size_manual(values=c(3, 2, 2, 2, 2, 2, 2, 2, 2, 2)) +
scale_shape_manual(labels="", values=c("1"=16,"2"=16))+
scale_alpha_manual(values=c(1, 0.4)) +
guides(size=FALSE, alpha=FALSE) + #removes the legend
ggtitle(label = "A.")+
scale_y_discrete(limits = rev(unique(sort(dfwide$var))), labels=estimates) + ylab("") +
labs(col="Effects") + theme(legend.position = "none", legend.box.background = element_rect(),
legend.title=element_blank(), legend.key.size = unit(0.05, "cm")) +
xlab("Parameter Estimate (days)")
diff<-ggplot(dxx, aes(x=factor(code), y=diff, col=factor(code))) + geom_point() +
geom_linerange(aes(ymin=diff-diff.sd, ymax=diff+diff.sd), alpha=0.3) +
ylab(expression(atop("Model Estimate of Change ", paste("in Duration of Vegetative Risk (days)")))) + coord_cartesian(ylim=c(0,25)) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.title.x=element_blank(),
axis.text.x = element_text(face = "italic", angle=45, hjust=1),
axis.text=element_text(size=10), legend.position = "none") +
scale_colour_manual(values=c("firebrick3", "orangered1","orange3", "sienna4","sienna2", "green4", "green3", "purple2", "magenta3")) +
ggtitle(label="B.")
ggarrange(fig1, diff, ncol=2)
ggarrange(fig1, diff, ncol=2)
ggarrange(fig1, diff, ncol=2)
diff<-ggplot(dxx, aes(x=factor(code), y=diff, col=factor(code))) + geom_point(alpha=0.5) +
geom_linerange(aes(ymin=diff-diff.sd, ymax=diff+diff.sd), alpha=0.5) +
ylab(expression(atop("Model Estimate of Change ", paste("in Duration of Vegetative Risk (days)")))) + coord_cartesian(ylim=c(0,25)) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.title.x=element_blank(),
axis.text.x = element_text(face = "italic", angle=45, hjust=1),
axis.text=element_text(size=10), legend.position = "none") +
scale_colour_manual(values=c("firebrick3", "orangered1","orange3", "sienna4","sienna2", "green4", "green3", "purple2", "magenta3")) +
ggtitle(label="B.")
ggarrange(fig1, diff, ncol=2)
ggarrange(fig1, diff, ncol=2)
fig1 <-ggplot(dfwide, aes(x=Estimate, y=var, color=legend, size=factor(rndm), alpha=factor(rndm)))+
geom_point(position =pd)+
geom_errorbarh(aes(xmin=(`2.5%`), xmax=(`95%`)), position=pd, size=.5, height =0, width=0)+
geom_vline(xintercept=0)+
scale_colour_manual(values=c("blue", "firebrick3", "orangered1","orange3", "sienna4","sienna2", "green4", "green3", "purple2", "magenta3"),
breaks=c("Overall Effects"))+
scale_size_manual(values=c(3, 2, 2, 2, 2, 2, 2, 2, 2, 2)) +
scale_shape_manual(labels="", values=c("1"=16,"2"=16))+
scale_alpha_manual(values=c(1, 0.5)) +
guides(size=FALSE, alpha=FALSE) + #removes the legend
ggtitle(label = "A.")+
scale_y_discrete(limits = rev(unique(sort(dfwide$var))), labels=estimates) + ylab("") +
labs(col="Effects") + theme(legend.position = "none", legend.box.background = element_rect(),
legend.title=element_blank(), legend.key.size = unit(0.05, "cm")) +
xlab("Parameter Estimate (days)")
ggarrange(fig1, diff, ncol=2)
