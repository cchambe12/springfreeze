cues<-cues[!(cues$datasetID=="sogaard08" & cues$numcues==0),]
cues<-cues[!(cues$datasetID=="granhus09" | cues$datasetID=="rinne94" | cues$datasetID=="spann04"),]
cues$yr<-round(cues$year, digits=0)
studies<-as.data.frame(table(cues$yr))
studies<-studies%>%rename(yr=Var1)%>%rename(studies=Freq)
studies$yr<-as.numeric(as.character(studies$yr))
cues<-inner_join(cues, studies)
cues$cols<-NA
cues$cols<-ifelse(cues$numcues==1, "blue", cues$cols)
cues$cols<-ifelse(cues$numcues==2, "green", cues$cols)
cues$cols<-ifelse(cues$numcues==3, "red", cues$cols)
cues$cols<-ifelse(cues$numcues==0, "white", cues$cols)
hist<-ggplot(cues, aes(x=yr)) + geom_histogram(aes(fill=cols), size=0.3) +
xlab("Year") + ylab("Number of Studies") + scale_y_continuous(expand = c(0, 0)) +
scale_fill_manual(values=c("#CC6666", "#9999CC", "#66CC99", "lightgrey"), name="Number of Cues",
labels=c("blue"="1", "green"="2", "red"="3", "white"="0")) + scale_x_continuous(breaks=c(1950, 1960, 1970, 1980, 1990, 2000, 2010)) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"), legend.text = element_text(size=8), legend.key.size = unit(0.5, "cm"),
axis.title=element_text(size=12), legend.title = element_text(size=8), axis.text=element_text(size=10))
hist
rm(list=ls()) # remove everything currently held in the R memory
options(stringsAsFactors=FALSE)
graphics.off()
forlatex = TRUE # set to FALSE if just trying new figures, TRUE if outputting for final
runstan = TRUE # set to TRUE to actually run stan models. FALSE if loading from previous runs
# Analysis of bud burst experiment 2015.
library(ggplot2)
library(rstan)
library(rstanarm)
library(shinystan)
library(bayesplot)
library(dplyr)
library(gridExtra)
library(brms)
library(egg)
library(ggstance)
setwd("~/Documents/git/springfreeze/")
source('scripts/stan/savestan.R')
dx<-read.csv("output/danfdata.csv", header=TRUE)
# Prep
dx<-dx[!(dx$chill==2),]
dx$chill<-ifelse(dx$chill==1, 0, 1)
#dx<-dx%>%filter(species!="VIBCAS")%>%filter(species!="VIBLAN")
dx$sp <- as.numeric(as.factor(dx$sp))
#dx$site <- as.numeric(as.factor(dx$site))
dx<-dx[!is.na(dx$risk),]
levels(dx$warm) = c(0,1); levels(dx$photo) = c(0, 1); levels(dx$chill) = c(0,1)
dx$warm <- as.numeric(dx$warm)
dx$warm<-ifelse(dx$warm==15, 0, 1)
dx$photo <- as.numeric(dx$photo)
dx$photo<-ifelse(dx$photo==12, 0, 1)
dx$chill <- as.numeric(dx$chill)
dxb <- dx[!is.na(dx$risk),]
# <> <> <> <> <> <> <> <> <> <> <> <> <> <> <> <> <> <> <> <>
# Important: Fixing the 1/2 issue to 0/1 here
# <> <> <> <> <> <> <> <> <> <> <> <> <> <> <> <> <> <> <> <>
unique(dxb$warm)
dxb<-filter(dxb, risk>0)
risk = as.numeric(dxb$risk) # dvr as response
warm = dxb$warm
#site = as.numeric(dxb$site)
sp = as.numeric(dxb$sp)
photo = dxb$photo
chill = as.numeric(dxb$chill1)
#chill2 = as.numeric(dxb$chill2)
N = length(risk)
n_sp = length(unique(dxb$sp))
datalist.b<-list(risk=risk, warm=warm, sp=sp, photo=photo, chill1=chill1, chill2=chill2, N=N, n_sp=n_sp)
dxb$force<-dxb$warm
fit.brm<-brm(risk~ force + photo + chill + force:photo + force:chill +
photo:chill + (force + photo + chill + force:photo + force:chill +
photo:chill|sp), data=dxb)
m<-fit.brm
m.int<-posterior_interval(m)
sum.m<-summary(m)
cri.f<-as.data.frame(sum.m$fixed[,c("Estimate", "l-95% CI", "u-95% CI")])
cri.f<-cri.f[-1,] #removing the intercept
fdf1<-as.data.frame(rbind(as.vector(cri.f[,1]), as.vector(cri.f[,2]), as.vector(cri.f[,3])))
fdf2<-cbind(fdf1, c(0, 0, 0) , c("Estimate", "2.5%", "95%"))
names(fdf2)<-c(rownames(cri.f), "sp", "perc")
cri.r<-(ranef(m, summary = TRUE, robust = FALSE,
probs = c(0.025, 0.975)))$sp
cri.r2<-cri.r[, ,-1]
cri.r2<-cri.r2[,-2,]
dims<-dim(cri.r2)
twoDimMat <- matrix(cri.r2, prod(dims[1:2]), dims[3])
mat2<-cbind(twoDimMat, c(rep(1:9, length.out=27)), rep(c("Estimate", "2.5%", "95%"), each=9))
df<-as.data.frame(mat2)
names(df)<-c(rownames(cri.f), "sp", "perc")
dftot<-rbind(fdf2, df)
dflong<- tidyr::gather(dftot, var, value, force:`photo:chill`, factor_key=TRUE)
#adding the coef estiamtes to the random effect values
for (i in seq(from=1,to=nrow(dflong), by=30)) {
for (j in seq(from=3, to=29, by=1)) {
dflong$value[i+j]<- as.numeric(dflong$value[i+j]) + as.numeric(dflong$value[i])
}
}
dflong$rndm<-ifelse(dftot$sp>0, 2, 1)
dfwide<-tidyr::spread(dflong, perc, value)
dfwide[,4:6] <- as.data.frame(lapply(c(dfwide[,4:6]), as.numeric ))
dfwide$sp<-as.factor(dfwide$sp)
### Now make a new dataframe for more conceptual figure
simple<-subset(dfwide, select=c("sp", "var", "Estimate"))
simple<-simple[(simple$sp=="1"|simple$sp=="7"),]
simple$sp<-ifelse(simple$sp=="1", "1", "9")
simple<-simple[!(simple$var=="photo:chill"),]
estimates<-c("More Forcing", "Shorter Photoperiod", "Less Chilling", "More Forcing and \nShorter Photoperiod",
"More Forcing and \nLess Chilling")
#pd <- position_dodgev(height = -0.5)
#simple$Jvar <- ave(as.numeric(simple$var), simple$var,
#                         FUN = function(x) x + rnorm(length(x), sd = .1))
simple$Jvar<-as.numeric(as.factor(simple$var))
simple$Jvar<-ifelse(simple$sp=="1", simple$Jvar-0.1, simple$Jvar)
simple$Jvar2<-rev(simple$Jvar)
simple$est2<-ifelse(simple$sp=="1" & simple$var=="force:photo", simple$Estimate[simple$var=="force" & simple$sp=="1"]+
simple$Estimate[simple$var=="photo" & simple$sp=="1"]+
simple$Estimate[simple$var=="force:photo" & simple$sp=="1"], simple$Estimate)
simple$est2<-ifelse(simple$sp=="1" & simple$var=="force:chill", simple$Estimate[simple$var=="force" & simple$sp=="1"]+
simple$Estimate[simple$var=="chill" & simple$sp=="1"]+
simple$Estimate[simple$var=="force:chill" & simple$sp=="1"], simple$est2)
simple$est2<-ifelse(simple$sp=="2" & simple$var=="force:photo", simple$Estimate[simple$var=="force" & simple$sp=="2"]+
simple$Estimate[simple$var=="photo" & simple$sp=="2"]+
simple$Estimate[simple$var=="force:photo" & simple$sp=="2"], simple$est2)
simple$est2<-ifelse(simple$sp=="2" & simple$var=="force:chill", simple$Estimate[simple$var=="force" & simple$sp=="2"]+
simple$Estimate[simple$var=="chill" & simple$sp=="2"]+
simple$Estimate[simple$var=="force:chill" & simple$sp=="2"], simple$est2)
estimates<-rev(estimates)
exp<-ggplot(simple, aes(x=0, xend=est2, y=Jvar2, yend=Jvar2, col=sp)) +
geom_vline(xintercept=0, linetype="dotted") +
scale_colour_manual(name="Species", values=c("firebrick3", "darkblue"),
labels=c("1"=expression(paste(italic("Acer pensylvanicum"))),
"9"=expression(paste(italic("Ilex mucronata"))))) +
geom_segment(arrow = arrow(length = unit(0.03, "npc"))) +
scale_y_discrete(limits = sort(unique(simple$var)), labels=estimates) +
xlab("Change in Duration (Days) \nof Vegetative Risk") + ylab("") +
geom_hline(yintercept=2.5, col="grey") +
annotate("text", x = -6.7, y = 2.4, label = "Combined Effects:", fontface="bold", size=3) +
annotate("text", x = -7, y = 5.5, label = "Simple Effects:", fontface="bold", size=3) +
theme(legend.text=element_text(size=8), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
legend.position=c(0.8, 0.8), axis.line.x.top=element_line(), axis.line.y.right=element_line())
exp<-ggplot(simple, aes(x=0, xend=est2, y=Jvar2, yend=Jvar2, col=sp)) +
geom_vline(xintercept=0, linetype="dotted") +
scale_colour_manual(name="Species", values=c("firebrick3", "darkblue"),
labels=c("1"=expression(paste(italic("Acer pensylvanicum"))),
"9"=expression(paste(italic("Ilex mucronata"))))) +
geom_segment(arrow = arrow(length = unit(0.03, "npc"))) +
scale_y_discrete(limits = sort(unique(simple$var)), labels=estimates) +
xlab("Change in Duration (Days) \nof Vegetative Risk") + ylab("") +
geom_hline(yintercept=2.5, col="grey") +
annotate("text", x = -6.7, y = 2.4, label = "Combined Effects:", fontface="bold", size=3) +
annotate("text", x = -7, y = 5.5, label = "Simple Effects:", fontface="bold", size=3) +
theme(legend.text=element_text(size=8), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
legend.position=c(0.8, 0.8)) + theme_linedraw()
exp
quartz()
exp
### Now make a new dataframe for more conceptual figure
simple<-subset(dfwide, select=c("sp", "var", "Estimate"))
simple<-simple[(simple$sp=="4"|simple$sp=="7"|simple$sp=="6"),]
#simple$sp<-ifelse(simple$sp=="4", "1", "9")
simple<-simple[!(simple$var=="photo:chill"),]
estimates<-c("More Forcing", "Shorter Photoperiod", "Less Chilling", "More Forcing and \nShorter Photoperiod",
"More Forcing and \nLess Chilling")
#pd <- position_dodgev(height = -0.5)
#simple$Jvar <- ave(as.numeric(simple$var), simple$var,
#                         FUN = function(x) x + rnorm(length(x), sd = .1))
simple$Jvar<-as.numeric(as.factor(simple$var))
simple$Jvar<-ifelse(simple$sp=="4", simple$Jvar-0.05, simple$Jvar)
simple$Jvar<-ifelse(simple$sp=="7", simple$Jvar-0.1, simple$Jvar)
simple$Jvar2<-rev(simple$Jvar)
simple$est2<-ifelse(simple$sp=="4" & simple$var=="force:photo", simple$Estimate[simple$var=="force" & simple$sp=="4"]+
simple$Estimate[simple$var=="photo" & simple$sp=="4"]+
simple$Estimate[simple$var=="force:photo" & simple$sp=="1"], simple$Estimate)
simple$est2<-ifelse(simple$sp=="4" & simple$var=="force:chill", simple$Estimate[simple$var=="force" & simple$sp=="4"]+
simple$Estimate[simple$var=="chill" & simple$sp=="4"]+
simple$Estimate[simple$var=="force:chill" & simple$sp=="4"], simple$est2)
simple$est2<-ifelse(simple$sp=="7" & simple$var=="force:photo", simple$Estimate[simple$var=="force" & simple$sp=="7"]+
simple$Estimate[simple$var=="photo" & simple$sp=="7"]+
simple$Estimate[simple$var=="force:photo" & simple$sp=="7"], simple$est2)
simple$est2<-ifelse(simple$sp=="7" & simple$var=="force:chill", simple$Estimate[simple$var=="force" & simple$sp=="7"]+
simple$Estimate[simple$var=="chill" & simple$sp=="7"]+
simple$Estimate[simple$var=="force:chill" & simple$sp=="7"], simple$est2)
simple$est2<-ifelse(simple$sp=="6" & simple$var=="force:photo", simple$Estimate[simple$var=="force" & simple$sp=="6"]+
simple$Estimate[simple$var=="photo" & simple$sp=="6"]+
simple$Estimate[simple$var=="force:photo" & simple$sp=="6"], simple$est2)
simple$est2<-ifelse(simple$sp=="6" & simple$var=="force:chill", simple$Estimate[simple$var=="force" & simple$sp=="6"]+
simple$Estimate[simple$var=="chill" & simple$sp=="6"]+
simple$Estimate[simple$var=="force:chill" & simple$sp=="6"], simple$est2)
estimates<-rev(estimates)
exp<-ggplot(simple, aes(x=0, xend=est2, y=Jvar2, yend=Jvar2, col=sp)) +
geom_vline(xintercept=0, linetype="dotted") +
scale_colour_manual(name="Species", values=c("firebrick3", "darkblue"),
labels=c("4"=expression(paste(italic("Betula alleghaniensis"))),
"7"=expression(paste(italic("Ilex mucronata"))),
"6"=expression(paste(italic("Fagus grandifolia"))))) +
geom_segment(arrow = arrow(length = unit(0.03, "npc"))) +
scale_y_discrete(limits = sort(unique(simple$var)), labels=estimates) +
xlab("Change in Duration (Days) \nof Vegetative Risk") + ylab("") +
geom_hline(yintercept=2.5, col="grey") +
annotate("text", x = -6.7, y = 2.4, label = "Combined Effects:", fontface="bold", size=3) +
annotate("text", x = -7, y = 5.5, label = "Simple Effects:", fontface="bold", size=3) +
theme(legend.text=element_text(size=8), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
legend.position=c(0.8, 0.8)) + theme_linedraw()
exp
exp<-ggplot(simple, aes(x=0, xend=est2, y=Jvar2, yend=Jvar2, col=sp)) +
geom_vline(xintercept=0, linetype="dotted") +
scale_colour_manual(name="Species", values=c("#CC6666", "#9999CC", "#66CC99"),
labels=c("4"=expression(paste(italic("Betula alleghaniensis"))),
"7"=expression(paste(italic("Ilex mucronata"))),
"6"=expression(paste(italic("Fagus grandifolia"))))) +
geom_segment(arrow = arrow(length = unit(0.03, "npc"))) +
scale_y_discrete(limits = sort(unique(simple$var)), labels=estimates) +
xlab("Change in Duration (Days) \nof Vegetative Risk") + ylab("") +
geom_hline(yintercept=2.5, col="grey") +
annotate("text", x = -6.7, y = 2.4, label = "Combined Effects:", fontface="bold", size=3) +
annotate("text", x = -7, y = 5.5, label = "Simple Effects:", fontface="bold", size=3) +
theme(legend.text=element_text(size=8), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
legend.position=c(0.8, 0.8)) + theme_linedraw()
exp
View(dfwide)
### Now make a new dataframe for more conceptual figure
simple<-subset(dfwide, select=c("sp", "var", "Estimate"))
simple<-simple[(simple$sp=="1"|simple$sp=="8"|simple$sp=="6"),]
#simple$sp<-ifelse(simple$sp=="4", "1", "9")
simple<-simple[!(simple$var=="photo:chill"),]
estimates<-c("More Forcing", "Shorter Photoperiod", "Less Chilling", "More Forcing and \nShorter Photoperiod",
"More Forcing and \nLess Chilling")
#pd <- position_dodgev(height = -0.5)
#simple$Jvar <- ave(as.numeric(simple$var), simple$var,
#                         FUN = function(x) x + rnorm(length(x), sd = .1))
simple$Jvar<-as.numeric(as.factor(simple$var))
simple$Jvar<-ifelse(simple$sp=="1", simple$Jvar-0.1, simple$Jvar)
simple$Jvar<-ifelse(simple$sp=="8", simple$Jvar-0.2, simple$Jvar)
simple$Jvar2<-rev(simple$Jvar)
simple$est2<-ifelse(simple$sp=="1" & simple$var=="force:photo", simple$Estimate[simple$var=="force" & simple$sp=="1"]+
simple$Estimate[simple$var=="photo" & simple$sp=="1"]+
simple$Estimate[simple$var=="force:photo" & simple$sp=="1"], simple$Estimate)
simple$est2<-ifelse(simple$sp=="1" & simple$var=="force:chill", simple$Estimate[simple$var=="force" & simple$sp=="1"]+
simple$Estimate[simple$var=="chill" & simple$sp=="1"]+
simple$Estimate[simple$var=="force:chill" & simple$sp=="1"], simple$est2)
simple$est2<-ifelse(simple$sp=="8" & simple$var=="force:photo", simple$Estimate[simple$var=="force" & simple$sp=="8"]+
simple$Estimate[simple$var=="photo" & simple$sp=="8"]+
simple$Estimate[simple$var=="force:photo" & simple$sp=="8"], simple$est2)
simple$est2<-ifelse(simple$sp=="8" & simple$var=="force:chill", simple$Estimate[simple$var=="force" & simple$sp=="8"]+
simple$Estimate[simple$var=="chill" & simple$sp=="8"]+
simple$Estimate[simple$var=="force:chill" & simple$sp=="8"], simple$est2)
simple$est2<-ifelse(simple$sp=="6" & simple$var=="force:photo", simple$Estimate[simple$var=="force" & simple$sp=="6"]+
simple$Estimate[simple$var=="photo" & simple$sp=="6"]+
simple$Estimate[simple$var=="force:photo" & simple$sp=="6"], simple$est2)
simple$est2<-ifelse(simple$sp=="6" & simple$var=="force:chill", simple$Estimate[simple$var=="force" & simple$sp=="6"]+
simple$Estimate[simple$var=="chill" & simple$sp=="6"]+
simple$Estimate[simple$var=="force:chill" & simple$sp=="6"], simple$est2)
estimates<-rev(estimates)
exp<-ggplot(simple, aes(x=0, xend=est2, y=Jvar2, yend=Jvar2, col=sp)) +
geom_vline(xintercept=0, linetype="dotted") +
scale_colour_manual(name="Species", values=c("#CC6666", "#9999CC", "#66CC99"),
labels=c("1"=expression(paste(italic("Acer pensylvanicum"))),
"8"=expression(paste(italic("Populus grandidentata"))),
"6"=expression(paste(italic("Fagus grandifolia"))))) +
geom_segment(arrow = arrow(length = unit(0.03, "npc"))) +
scale_y_discrete(limits = sort(unique(simple$var)), labels=estimates) +
xlab("Change in Duration (Days) \nof Vegetative Risk") + ylab("") +
geom_hline(yintercept=2.5, col="grey") +
annotate("text", x = -6.7, y = 2.4, label = "Combined Effects:", fontface="bold", size=3) +
annotate("text", x = -7, y = 5.5, label = "Simple Effects:", fontface="bold", size=3) +
theme(legend.text=element_text(size=8), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
legend.position=c(0.8, 0.8)) + theme_linedraw()
exp
exp<-ggplot(simple, aes(x=0, xend=est2, y=Jvar2, yend=Jvar2, col=sp)) +
geom_vline(xintercept=0, linetype="dotted") +
scale_colour_manual(name="Species", values=c("#CC6666", "#9999CC", "#66CC99"),
labels=c("1"=expression(paste(italic("Acer pensylvanicum"))),
"8"=expression(paste(italic("Populus grandidentata"))),
"6"=expression(paste(italic("Fagus grandifolia"))))) +
geom_segment(arrow = arrow(length = unit(0.03, "npc"))) +
scale_y_discrete(limits = sort(unique(simple$var)), labels=estimates) +
xlab("Change in Duration (Days) \nof Vegetative Risk") + ylab("") +
geom_hline(yintercept=2.5, col="grey") +
annotate("text", x = -6.4, y = 2.4, label = "Combined Effects:", fontface="bold", size=3) +
annotate("text", x = -6.8, y = 5.5, label = "Simple Effects:", fontface="bold", size=3) +
theme(legend.text=element_text(size=8), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
legend.position=c(0.8, 0.8)) + theme_linedraw()
exp
exp<-ggplot(simple, aes(x=0, xend=est2, y=Jvar2, yend=Jvar2, col=sp)) +
geom_vline(xintercept=0, linetype="dotted") +
scale_colour_manual(name="Species", values=c("#CC6666", "#9999CC", "#66CC99"),
labels=c("1"=expression(paste(italic("Acer pensylvanicum"))),
"8"=expression(paste(italic("Populus grandidentata"))),
"6"=expression(paste(italic("Fagus grandifolia"))))) +
geom_segment(arrow = arrow(length = unit(0.03, "npc"))) +
scale_y_discrete(limits = sort(unique(simple$var)), labels=estimates) +
xlab("Change in Duration (Days) \nof Vegetative Risk") + ylab("") +
geom_hline(yintercept=2.5, col="grey") +
annotate("text", x = -6.4, y = 2.4, label = "Combined Effects:", fontface="bold", size=3) +
annotate("text", x = -6.8, y = 5.5, label = "Simple Effects:", fontface="bold", size=3) +
theme(legend.text=element_text(size=8), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
legend.position=c(0.8, 0.8)) + theme_linedraw() + coord_cartesian(ylim=c(0,5.5))
exp
exp<-ggplot(simple, aes(x=0, xend=est2, y=Jvar2, yend=Jvar2, col=sp)) +
geom_vline(xintercept=0, linetype="dotted") +
scale_colour_manual(name="Species", values=c("#CC6666", "#9999CC", "#66CC99"),
labels=c("1"=expression(paste(italic("Acer pensylvanicum"))),
"8"=expression(paste(italic("Populus grandidentata"))),
"6"=expression(paste(italic("Fagus grandifolia"))))) +
geom_segment(arrow = arrow(length = unit(0.03, "npc"))) +
scale_y_discrete(limits = sort(unique(simple$var)), labels=estimates) +
xlab("Change in Duration (Days) \nof Vegetative Risk") + ylab("") +
geom_hline(yintercept=2.5, col="grey") +
annotate("text", x = -6.4, y = 2.4, label = "Combined Effects:", fontface="bold", size=3) +
annotate("text", x = -6.8, y = 5.5, label = "Simple Effects:", fontface="bold", size=3) +
theme(legend.text=element_text(size=8), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
legend.position=c(0.8, 0.8)) + theme_linedraw() + coord_cartesian(ylim=c(0.75,5.25))
exp
exp<-ggplot(simple, aes(x=0, xend=est2, y=Jvar2, yend=Jvar2, col=sp)) +
geom_vline(xintercept=0, linetype="dotted") +
scale_colour_manual(name="Species", values=c("#CC6666", "#9999CC", "#66CC99"),
labels=c("1"=expression(paste(italic("Acer pensylvanicum"))),
"8"=expression(paste(italic("Populus grandidentata"))),
"6"=expression(paste(italic("Fagus grandifolia"))))) +
geom_segment(arrow = arrow(length = unit(0.03, "npc"))) +
scale_y_discrete(limits = sort(unique(simple$var)), labels=estimates) +
xlab("Change in Duration (Days) \nof Vegetative Risk") + ylab("") +
geom_hline(yintercept=2.5, col="grey") +
annotate("text", x = -6.4, y = 2.4, label = "Combined Effects:", fontface="bold", size=3) +
annotate("text", x = -6.8, y = 5.5, label = "Simple Effects:", fontface="bold", size=3) +
theme(legend.text=element_text(size=8), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
legend.position=c(0.8, 0.8)) + theme_linedraw() + coord_cartesian(ylim=c(0.85,5.15))
exp
exp<-ggplot(simple, aes(x=0, xend=est2, y=Jvar2, yend=Jvar2, col=sp)) +
geom_vline(xintercept=0, linetype="dotted") +
scale_colour_manual(name="Species", values=c("#CC6666", "#9999CC", "#66CC99"),
labels=c("1"=expression(paste(italic("Acer pensylvanicum"))),
"8"=expression(paste(italic("Populus grandidentata"))),
"6"=expression(paste(italic("Fagus grandifolia"))))) +
geom_segment(arrow = arrow(length = unit(0.03, "npc"))) +
scale_y_discrete(limits = sort(unique(simple$var)), labels=estimates) +
xlab("Change in Duration (Days) \nof Vegetative Risk") + ylab("") +
geom_hline(yintercept=2.5, col="grey") +
annotate("text", x = -6.4, y = 2.4, label = "Combined Effects:", fontface="bold", size=3) +
annotate("text", x = -6.8, y = 5.5, label = "Simple Effects:", fontface="bold", size=3) +
theme(legend.text=element_text(size=8), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
legend.position=c(0.8, 0.8)) + theme_linedraw() + coord_cartesian(ylim=c(0.95,5.05))
exp
exp<-ggplot(simple, aes(x=0, xend=est2, y=Jvar2, yend=Jvar2, col=sp)) +
geom_vline(xintercept=0, linetype="dotted") +
scale_colour_manual(name="Species", values=c("#CC6666", "#9999CC", "#66CC99"),
labels=c("1"=expression(paste(italic("Acer pensylvanicum"))),
"8"=expression(paste(italic("Populus grandidentata"))),
"6"=expression(paste(italic("Fagus grandifolia"))))) +
geom_segment(arrow = arrow(length = unit(0.03, "npc"))) +
scale_y_discrete(limits = sort(unique(simple$var)), labels=estimates) +
xlab("Change in Duration (Days) \nof Vegetative Risk") + ylab("") +
geom_hline(yintercept=2.5, col="grey") +
annotate("text", x = -6.4, y = 2.4, label = "Combined Effects:", fontface="bold", size=3) +
annotate("text", x = -6.8, y = 5.5, label = "Simple Effects:", fontface="bold", size=3) +
theme(legend.text=element_text(size=8), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
legend.position=c(0.8, 0.8)) + theme_linedraw() + coord_cartesian(ylim=c(1,5))
exp
exp<-ggplot(simple, aes(x=0, xend=est2, y=Jvar2, yend=Jvar2, col=sp)) +
geom_vline(xintercept=0, linetype="dotted") +
scale_colour_manual(name="Species", values=c("#CC6666", "#9999CC", "#66CC99"),
labels=c("1"=expression(paste(italic("Acer pensylvanicum"))),
"8"=expression(paste(italic("Populus grandidentata"))),
"6"=expression(paste(italic("Fagus grandifolia"))))) +
geom_segment(arrow = arrow(length = unit(0.03, "npc"))) +
scale_y_discrete(limits = sort(unique(simple$var)), labels=estimates) +
xlab("Change in Duration (Days) \nof Vegetative Risk") + ylab("") +
geom_hline(yintercept=2.5, col="grey") +
annotate("text", x = -6.35, y = 2.4, label = "Combined Effects:", fontface="bold", size=3) +
annotate("text", x = -6.8, y = 5.5, label = "Simple Effects:", fontface="bold", size=3) +
theme(legend.text=element_text(size=8), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
legend.position=c(0.8, 0.8)) + theme_linedraw() + coord_cartesian(ylim=c(1,5))
exp
# Prep
dx<-dx[!(dx$chill==2),]
#dx$chill<-ifelse(dx$chill==1, 0, 1)
#dx<-dx%>%filter(species!="VIBCAS")%>%filter(species!="VIBLAN")
dx$sp <- as.numeric(as.factor(dx$sp))
#dx$site <- as.numeric(as.factor(dx$site))
dx<-dx[!is.na(dx$risk),]
levels(dx$warm) = c(0,1); levels(dx$photo) = c(0, 1); levels(dx$chill) = c(0,1)
dx$warm <- as.numeric(dx$warm)
dx$warm<-ifelse(dx$warm==15, 0, 1)
dx$photo <- as.numeric(dx$photo)
dx$photo<-ifelse(dx$photo==12, 0, 1)
dx$chill <- as.numeric(dx$chill)
View(dfwide)
dx<-read.csv("output/danfdata.csv", header=TRUE)
View(dx)
simple<-subset(dfwide, select=c("sp", "var", "Estimate"))
simple<-simple[(simple$sp=="3"|simple$sp=="8"|simple$sp=="6"),]
#simple$sp<-ifelse(simple$sp=="4", "1", "9")
simple<-simple[!(simple$var=="photo:chill"),]
estimates<-c("More Forcing", "Shorter Photoperiod", "Less Chilling", "More Forcing and \nShorter Photoperiod",
"More Forcing and \nLess Chilling")
#pd <- position_dodgev(height = -0.5)
#simple$Jvar <- ave(as.numeric(simple$var), simple$var,
#                         FUN = function(x) x + rnorm(length(x), sd = .1))
simple$Jvar<-as.numeric(as.factor(simple$var))
simple$Jvar<-ifelse(simple$sp=="3", simple$Jvar-0.1, simple$Jvar)
simple$Jvar<-ifelse(simple$sp=="8", simple$Jvar-0.2, simple$Jvar)
simple$Jvar2<-rev(simple$Jvar)
simple$est2<-ifelse(simple$sp=="3" & simple$var=="force:photo", simple$Estimate[simple$var=="force" & simple$sp=="3"]+
simple$Estimate[simple$var=="photo" & simple$sp=="3"]+
simple$Estimate[simple$var=="force:photo" & simple$sp=="3"], simple$Estimate)
simple$est2<-ifelse(simple$sp=="3" & simple$var=="force:chill", simple$Estimate[simple$var=="force" & simple$sp=="3"]+
simple$Estimate[simple$var=="chill" & simple$sp=="3"]+
simple$Estimate[simple$var=="force:chill" & simple$sp=="3"], simple$est2)
simple$est2<-ifelse(simple$sp=="8" & simple$var=="force:photo", simple$Estimate[simple$var=="force" & simple$sp=="8"]+
simple$Estimate[simple$var=="photo" & simple$sp=="8"]+
simple$Estimate[simple$var=="force:photo" & simple$sp=="8"], simple$est2)
simple$est2<-ifelse(simple$sp=="8" & simple$var=="force:chill", simple$Estimate[simple$var=="force" & simple$sp=="8"]+
simple$Estimate[simple$var=="chill" & simple$sp=="8"]+
simple$Estimate[simple$var=="force:chill" & simple$sp=="8"], simple$est2)
simple$est2<-ifelse(simple$sp=="6" & simple$var=="force:photo", simple$Estimate[simple$var=="force" & simple$sp=="6"]+
simple$Estimate[simple$var=="photo" & simple$sp=="6"]+
simple$Estimate[simple$var=="force:photo" & simple$sp=="6"], simple$est2)
simple$est2<-ifelse(simple$sp=="6" & simple$var=="force:chill", simple$Estimate[simple$var=="force" & simple$sp=="6"]+
simple$Estimate[simple$var=="chill" & simple$sp=="6"]+
simple$Estimate[simple$var=="force:chill" & simple$sp=="6"], simple$est2)
estimates<-rev(estimates)
exp<-ggplot(simple, aes(x=0, xend=est2, y=Jvar2, yend=Jvar2, col=sp)) +
geom_vline(xintercept=0, linetype="dotted") +
scale_colour_manual(name="Species", values=c("#CC6666", "#9999CC", "#66CC99"),
labels=c("1"=expression(paste(italic("Acer pensylvanicum"))),
"8"=expression(paste(italic("Populus grandidentata"))),
"6"=expression(paste(italic("Fagus grandifolia"))))) +
geom_segment(arrow = arrow(length = unit(0.03, "npc"))) +
scale_y_discrete(limits = sort(unique(simple$var)), labels=estimates) +
xlab("Change in Duration (Days) \nof Vegetative Risk") + ylab("") +
geom_hline(yintercept=2.5, col="grey") +
annotate("text", x = -6.35, y = 2.4, label = "Combined Effects:", fontface="bold", size=3) +
annotate("text", x = -6.8, y = 5.5, label = "Simple Effects:", fontface="bold", size=3) +
theme(legend.text=element_text(size=8), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
legend.position=c(0.8, 0.8)) + theme_linedraw() + coord_cartesian(ylim=c(1,5))
exp
quartz()
exp
exp<-ggplot(simple, aes(x=0, xend=est2, y=Jvar2, yend=Jvar2, col=sp)) +
geom_vline(xintercept=0, linetype="dotted") +
scale_colour_manual(name="Species", values=c("#CC6666", "#9999CC", "#66CC99"),
labels=c("3"=expression(paste(italic("Acer saccharum"))),
"8"=expression(paste(italic("Populus grandidentata"))),
"6"=expression(paste(italic("Fagus grandifolia"))))) +
geom_segment(arrow = arrow(length = unit(0.03, "npc"))) +
scale_y_discrete(limits = sort(unique(simple$var)), labels=estimates) +
xlab("Change in Duration (Days) \nof Vegetative Risk") + ylab("") +
geom_hline(yintercept=2.5, col="grey") +
annotate("text", x = -6.35, y = 2.4, label = "Combined Effects:", fontface="bold", size=3) +
annotate("text", x = -6.8, y = 5.5, label = "Simple Effects:", fontface="bold", size=3) +
theme(legend.text=element_text(size=8), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
legend.position=c(0.8, 0.8)) + theme_linedraw() + coord_cartesian(ylim=c(1,5))
exp
exp<-ggplot(simple, aes(x=0, xend=est2, y=Jvar2, yend=Jvar2, col=sp)) +
geom_vline(xintercept=0, linetype="dotted") +
scale_colour_manual(name="Species", values=c("#CC6666", "#9999CC", "#66CC99"),
labels=c("3"=expression(paste(italic("Acer saccharum"))),
"8"=expression(paste(italic("Populus grandidentata"))),
"6"=expression(paste(italic("Fagus grandifolia"))))) +
geom_segment(arrow = arrow(length = unit(0.03, "npc"))) +
scale_y_discrete(limits = sort(unique(simple$var)), labels=estimates) +
xlab("Change in Duration (Days) \nof Vegetative Risk") + ylab("") +
geom_hline(yintercept=2.5, col="grey") +
annotate("text", x = -4.35, y = 2.4, label = "Combined Effects:", fontface="bold", size=3) +
annotate("text", x = -4.8, y = 5.5, label = "Simple Effects:", fontface="bold", size=3) +
theme(legend.text=element_text(size=8), legend.title = element_text(size=9), legend.background = element_rect(linetype="solid", color="grey", size=0.5),
legend.position=c(0.8, 0.8)) + theme_linedraw() + coord_cartesian(ylim=c(1,5))
exp
rm(list=ls()) # remove everything currently held in the R memory
options(stringsAsFactors=FALSE)
graphics.off()
forlatex = TRUE # set to FALSE if just trying new figures, TRUE if outputting for final
runstan = TRUE # set to TRUE to actually run stan models. FALSE if loading from previous runs
# Analysis of bud burst experiment 2015.
library(ggplot2)
library(rstan)
library(rstanarm)
library(shinystan)
library(bayesplot)
library(dplyr)
library(gridExtra)
library(brms)
library(egg)
library(ggstance)
setwd("~/Documents/git/springfreeze/")
source('scripts/stan/savestan.R')
dx<-read.csv("output/danfdata.csv", header=TRUE)
# Prep
#dx<-dx[!(dx$chill==1),]
#dx$chill<-ifelse(dx$chill==2, 0, 1)
#dx<-dx%>%filter(species!="VIBCAS")%>%filter(species!="VIBLAN")
dx$sp <- as.numeric(as.factor(dx$sp))
#dx$site <- as.numeric(as.factor(dx$site))
dx<-dx[!is.na(dx$risk),]
levels(dx$warm) = c(0,1); levels(dx$photo) = c(0, 1); levels(dx$chill) = c(0,1)
dx$warm <- as.numeric(dx$warm)
dx$warm<-ifelse(dx$warm==15, 0, 1)
dx$photo <- as.numeric(dx$photo)
dx$photo<-ifelse(dx$photo==12, 0, 1)
dx$chill <- as.numeric(dx$chill)
#dx$site<- as.numeric(dx$site)
# Chill dummy variables
dx$chill1 = ifelse(dx$chill == 1, 1, 0)
dx$chill2 = ifelse(dx$chill == 2, 1, 0)
dxb <- dx[!is.na(dx$risk),]
dxb$force<-dxb$warm
fit.brm<-brm(risk~ force + photo + chill + force:photo + force:chill +
photo:chill + (force + photo + chill + force:photo + force:chill +
photo:chill|sp), data=dxb)
fit.brm<-brm(risk~ force + photo + chill1 + chill2 + force:photo + force:chill1 + force:chill2 +
photo:chill1 + photo:chill2 + (force + photo + chill1 + chill2 + force:photo +
force:chill1 + force:chill2 +
photo:chill1 + photo:chill2|sp), data=dxb)
