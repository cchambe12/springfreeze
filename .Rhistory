count<-count[!duplicated(count),]
count$doy<-as.numeric(count$doy)
View(count)
count<-filter(count, count<=500)
gdd<-d
gdd$bb.jd<-as.numeric(gdd$bb.jd)
gdd$bb.gdd<-NA
gdd$l75.gdd<-NA
for(i in c(1:nrow(gdd))){
for(j in c(1:nrow(count)))
gdd$bb.gdd[i]<-ifelse(gdd$bb.jd[i]==count$doy[j] & gdd$year[i]==count$year[j], count$count[j], gdd$bb.gdd[i])
}
for(i in c(1:nrow(gdd))){
for(j in c(1:nrow(count)))
gdd$l75.gdd[i]<-ifelse(gdd$l75.jd[i]==count$doy[j] & gdd$year[i]==count$year[j], count$count[j], gdd$l75.gdd[i])
}
gdd$agdd<-gdd$l75.gdd-gdd$bb.gdd
gdd$z.agdd<-scale(gdd$agdd, center=TRUE, scale=FALSE)
gdd$z.bb<-scale(gdd$bb.jd, center=TRUE, scale=FALSE)
gdd$z.year<-scale(gdd$year, center=TRUE, scale=FALSE)
gdd$z.risk<-scale(gdd$risk, center=TRUE, scale=FALSE)
gdd$z.bbgdd<-scale(gdd$bb.gdd, center=TRUE, scale=FALSE)
gdd$mean<-ave(gdd$bb.jd, gdd$year)
gdd$z.mean<-scale(gdd$mean, center=TRUE, scale=FALSE)
gdd$m.risk<-ave(gdd$risk, gdd$year)
dg<-dplyr::select(gdd, -z.agdd, -z.bb, -z.year, -z.risk, -z.bbgdd)
dg$mean<-ave(dg$bb.jd, dg$year)
ggplot(gdd, x=species, y=bb.gdd) + geom_boxplot(aes(x=species, y=bb.gdd))
m2<-lm(risk~bb.jd, data=gdd)
display(m2)
m3<-lm(agdd~bb.jd, data=gdd)
display(m3)
rm(list=ls()) # remove everything currently held in the R memory
options(stringsAsFactors=FALSE)
graphics.off()
# Load libraries
library(dplyr)
library(tidyr)
library(ggplot2)
library(lubridate)
library(rstanarm)
library(arm)
# Set Working Directory
setwd("~/Documents/git/springfreeze")
timeline<-read.csv("input/hf003-06-mean-spp.csv", header=TRUE)
weather<-read.csv("input/WeatherData.csv", header=TRUE)
hf<-timeline[!is.na(timeline$l75.jd),]
spp<-as.data.frame(table(hf$species))
spp$include<-ifelse(spp$Freq==25, TRUE, NA)
spp<-spp[!is.na(spp$include),]
sp<-unique(spp$Var1)
d<-timeline%>%
dplyr::select(year, species, bb.jd, l75.jd) %>%
filter(species%in%sp)
d$year<-as.numeric(d$year)
d$risk<-d$l75.jd-d$bb.jd
d<-na.omit(d)
df<-d%>%
gather("phenophase", "doy", bb.jd, l75.jd)
x<-paste(df$year, df$doy)
df$Date<-as.Date(strptime(x, format="%Y %j"))
## Weather data
w<-weather %>%
filter(Site == "hf")%>%
filter(JD<=180)
w$AirT<-ifelse(is.na(w$AirT), 0, w$AirT)
w$gdd <- w$AirT - 5
w$gdd <-ifelse(w$gdd>0, w$gdd, 0)
w$count <- ave(
w$gdd, w$Year,
FUN=function(x) cumsum(c(0, head(x, -1)))
)
w<-dplyr::rename(w, year=Year)
w<-dplyr::rename(w, doy=JD)
x<-paste(w$year, w$doy)
w$Date<-as.Date(strptime(x, format="%Y %j"))
View(w)
w$frz<-ifelse(w$AirTMin<=-2.2, 1, 0)
w<-dplyr::select(w, Date, gdd, count, frz)
w$year<-as.numeric(substr(w$Date, 1, 4))
dx<-inner_join(df,w)
View(dx)
View(d)
dx$fs <- ave(
dx$frz, dx$year,
FUN=function(x) cumsum(c(0, head(x, -1)))
)
View(dx)
w$fs <- ave(
w$frz, w$year,
FUN=function(x) cumsum(c(0, head(x, -1)))
)
View(w)
dx<-inner_join(df,w)
View(dx)
setwd("~/Documents/git/springfreeze")
timeline<-read.csv("input/hf003-06-mean-spp.csv", header=TRUE)
weather<-read.csv("input/WeatherData.csv", header=TRUE)
hf<-timeline[!is.na(timeline$l75.jd),]
spp<-as.data.frame(table(hf$species))
spp$include<-ifelse(spp$Freq==25, TRUE, NA)
spp<-spp[!is.na(spp$include),]
sp<-unique(spp$Var1)
d<-timeline%>%
dplyr::select(year, species, bb.jd, l75.jd) %>%
filter(species%in%sp)
d$year<-as.numeric(d$year)
d$risk<-d$l75.jd-d$bb.jd
d<-na.omit(d)
df<-d%>%
gather("phenophase", "doy", bb.jd, l75.jd)
x<-paste(df$year, df$doy)
df$Date<-as.Date(strptime(x, format="%Y %j"))
## Weather data
w<-weather %>%
filter(Site == "hf")%>%
filter(JD<=180)
w$AirT<-ifelse(is.na(w$AirT), 0, w$AirT)
w$gdd <- w$AirT - 5
w$gdd <-ifelse(w$gdd>0, w$gdd, 0)
w$count <- ave(
w$gdd, w$Year,
FUN=function(x) cumsum(c(0, head(x, -1)))
)
w<-dplyr::rename(w, year=Year)
w<-dplyr::rename(w, doy=JD)
x<-paste(w$year, w$doy)
w$Date<-as.Date(strptime(x, format="%Y %j"))
w$frz<-ifelse(w$AirTMin<=-2.2, 1, 0)
w<-dplyr::select(w, Date, gdd, count, frz)
w$year<-as.numeric(substr(w$Date, 1, 4))
dx<-inner_join(df,w)
View(dx)
dx<- dx[order(dx$species, dx$year), ]
View(dx)
d.fs<-inner_join(w, df)
View(d.fs)
d.fs<- d.fs[order(d.fs$species, d.fs$year), ]
View(df)
d.fs$doy<-with(df, ave(doy, species, year, FUN = seq_along))
d.fs$doy<-with(df, ave(species, year, FUN = seq_along))
d.fs$doy<-with(df, ave(doy, species, year, FUN = seq_along))
d.fs$sp_year<-paste(d.fs$species, d.fs$year)
d.fs$sp_year<-paste(d.fs$species, d.fs$year)
for(i in unique(d.fs$sp_year)){
d.fs$doy<-seq(d.fs$phenophase[i]=="bb.jd", d.fs$phenophase[i]=="l75.jd", by=1)
}
View(w)
weather<-read.csv("input/WeatherData.csv", header=TRUE)
hf<-timeline[!is.na(timeline$l75.jd),]
spp<-as.data.frame(table(hf$species))
spp$include<-ifelse(spp$Freq==25, TRUE, NA)
spp<-spp[!is.na(spp$include),]
sp<-unique(spp$Var1)
d<-timeline%>%
dplyr::select(year, species, bb.jd, l75.jd) %>%
filter(species%in%sp)
d$year<-as.numeric(d$year)
d$risk<-d$l75.jd-d$bb.jd
d<-na.omit(d)
df<-d%>%
gather("phenophase", "doy", bb.jd, l75.jd)
x<-paste(df$year, df$doy)
df$Date<-as.Date(strptime(x, format="%Y %j"))
## Weather data
w<-weather %>%
filter(Site == "hf")%>%
filter(JD<=180)
w$AirT<-ifelse(is.na(w$AirT), 0, w$AirT)
w$gdd <- w$AirT - 5
w$gdd <-ifelse(w$gdd>0, w$gdd, 0)
w$count <- ave(
w$gdd, w$Year,
FUN=function(x) cumsum(c(0, head(x, -1)))
)
w<-dplyr::rename(w, year=Year)
w<-dplyr::rename(w, doy=JD)
x<-paste(w$year, w$doy)
w$Date<-as.Date(strptime(x, format="%Y %j"))
w$frz<-ifelse(w$AirTMin<=-2.2, 1, 0)
View(w)
fs<-full_join(w, df, by=c("doy", "year"))
View(fs)
fs<-full_join(w, df, by=c("doy", "year", "Date"))
View(fs)
fs<-dplyr::select(fs, Date, year, doy, count, phenophase, frz)
View(fs)
fs<-dplyr::select(fs, Date, year, doy, count, phenophase, frz, species)
fs<-full_join(w, df, by=c("doy", "year", "Date"))
fs<-dplyr::select(fs, Date, year, doy, count, phenophase, frz, species)
View(fs)
fs<-filter(fs, year>=1990)
View(fs)
fs<-fs%>%
filter(year>=1990)%>%
filter(doy>=90)
View(fs)
setwd("~/Documents/git/springfreeze")
timeline<-read.csv("input/hf003-06-mean-spp.csv", header=TRUE)
weather<-read.csv("input/WeatherData.csv", header=TRUE)
hf<-timeline[!is.na(timeline$l75.jd),]
spp<-as.data.frame(table(hf$species))
spp$include<-ifelse(spp$Freq==25, TRUE, NA)
spp<-spp[!is.na(spp$include),]
sp<-unique(spp$Var1)
d<-timeline%>%
dplyr::select(year, species, bb.jd, l75.jd) %>%
filter(species%in%sp)
d$year<-as.numeric(d$year)
d$risk<-d$l75.jd-d$bb.jd
d<-na.omit(d)
df<-d%>%
gather("phenophase", "doy", bb.jd, l75.jd)
x<-paste(df$year, df$doy)
df$Date<-as.Date(strptime(x, format="%Y %j"))
## Weather data
w<-weather %>%
filter(Site == "hf")%>%
filter(JD<=180)
w$AirT<-ifelse(is.na(w$AirT), 0, w$AirT)
w$gdd <- w$AirT - 5
w$gdd <-ifelse(w$gdd>0, w$gdd, 0)
w$count <- ave(
w$gdd, w$Year,
FUN=function(x) cumsum(c(0, head(x, -1)))
)
w<-dplyr::rename(w, year=Year)
w<-dplyr::rename(w, doy=JD)
x<-paste(w$year, w$doy)
w$Date<-as.Date(strptime(x, format="%Y %j"))
w$frz<-ifelse(w$AirTMin<0, 1, 0)
#w<-dplyr::select(w, Date, gdd, count, frz)
#w$year<-as.numeric(substr(w$Date, 1, 4))
fs<-full_join(w, df, by=c("doy", "year", "Date"))
fs<-dplyr::select(fs, Date, year, doy, count, phenophase, frz, species)
fs<-fs%>%
filter(year>=1990)%>%
filter(doy>=90)
View(fs)
View(d)
timeline<-read.csv("input/hf003-06-mean-spp.csv", header=TRUE)
weather<-read.csv("input/WeatherData.csv", header=TRUE)
hf<-timeline[!is.na(timeline$l75.jd),]
spp<-as.data.frame(table(hf$species))
spp$include<-ifelse(spp$Freq==25, TRUE, NA)
spp<-spp[!is.na(spp$include),]
sp<-unique(spp$Var1)
d<-timeline%>%
dplyr::select(year, species, bb.jd, l75.jd) %>%
filter(species%in%sp)
d$year<-as.numeric(d$year)
d$risk<-d$l75.jd-d$bb.jd
d<-na.omit(d)
df<-d%>%
gather("phenophase", "doy", bb.jd, l75.jd)
x<-paste(df$year, df$doy)
df$Date<-as.Date(strptime(x, format="%Y %j"))
## Weather data
w<-weather %>%
filter(Site == "hf")%>%
filter(JD<=180)
w$AirT<-ifelse(is.na(w$AirT), 0, w$AirT)
w$gdd <- w$AirT - 5
w$gdd <-ifelse(w$gdd>0, w$gdd, 0)
w$count <- ave(
w$gdd, w$Year,
FUN=function(x) cumsum(c(0, head(x, -1)))
)
w<-dplyr::rename(w, year=Year)
w<-dplyr::rename(w, doy=JD)
x<-paste(w$year, w$doy)
w$Date<-as.Date(strptime(x, format="%Y %j"))
w$frz<-ifelse(w$AirTMin<0, 1, 0)
w$bb<-NA
for(i in c(1:nrow(w))){
for(j in c(1:nrow(d)))
w$bb[i]<-ifelse(w$doy[i]==d$bb.jd[j] & w$year[i]==d$year[i], d$species[j], w$bb[i])
}
w$lo<-NA
for(i in c(1:nrow(w))){
for(j in c(1:nrow(d)))
w$lo[i]<-ifelse(w$doy[i]==d$l75.jd[j] & w$year[i]==d$year[i], d$species[j], w$lo[i])
}
View(w)
dx<-inner_join(df,w)
count<-dplyr::select(dx, doy, year, count)
count<-count[!duplicated(count),]
count$doy<-as.numeric(count$doy)
count<-filter(count, count<=500)
gdd<-d
gdd$bb.jd<-as.numeric(gdd$bb.jd)
gdd$bb.gdd<-NA
gdd$l75.gdd<-NA
for(i in c(1:nrow(gdd))){
for(j in c(1:nrow(count)))
gdd$bb.gdd[i]<-ifelse(gdd$bb.jd[i]==count$doy[j] & gdd$year[i]==count$year[j], count$count[j], gdd$bb.gdd[i])
}
for(i in c(1:nrow(gdd))){
for(j in c(1:nrow(count)))
gdd$l75.gdd[i]<-ifelse(gdd$l75.jd[i]==count$doy[j] & gdd$year[i]==count$year[j], count$count[j], gdd$l75.gdd[i])
}
gdd$agdd<-gdd$l75.gdd-gdd$bb.gdd
gdd$z.agdd<-scale(gdd$agdd, center=TRUE, scale=FALSE)
gdd$z.bb<-scale(gdd$bb.jd, center=TRUE, scale=FALSE)
gdd$z.year<-scale(gdd$year, center=TRUE, scale=FALSE)
gdd$z.risk<-scale(gdd$risk, center=TRUE, scale=FALSE)
gdd$z.bbgdd<-scale(gdd$bb.gdd, center=TRUE, scale=FALSE)
gdd$mean<-ave(gdd$bb.jd, gdd$year)
gdd$z.mean<-scale(gdd$mean, center=TRUE, scale=FALSE)
gdd$m.risk<-ave(gdd$risk, gdd$year)
dg<-dplyr::select(gdd, -z.agdd, -z.bb, -z.year, -z.risk, -z.bbgdd)
dg$mean<-ave(dg$bb.jd, dg$year)
m3<-lm(agdd~bb.jd, data=gdd)
display(m3)
m3<-lm(agdd~as.factor(year), data=gdd)
display(m3)
m3<-lmer(agdd~year+(1|species), data=gdd)
display(m3)
m3<-lmer(agdd~risk, data=gdd)
display(m3)
m3<-lm(agdd~risk, data=gdd)
display(m3)
m3<-lm(agdd~risk+bb.jd, data=gdd)
display(m3)
View(d)
rm(list=ls()) # remove everything currently held in the R memory
options(stringsAsFactors=FALSE)
graphics.off()
# Load libraries
library(dplyr)
library(tidyr)
library(ggplot2)
library(lubridate)
library(rstanarm)
library(arm)
# Set Working Directory
setwd("~/Documents/git/springfreeze")
timeline<-read.csv("input/hf003-06-mean-spp.csv", header=TRUE)
weather<-read.csv("input/WeatherData.csv", header=TRUE)
hf<-timeline[!is.na(timeline$l75.jd),]
spp<-as.data.frame(table(hf$species))
spp$include<-ifelse(spp$Freq==25, TRUE, NA)
spp<-spp[!is.na(spp$include),]
sp<-unique(spp$Var1)
d<-timeline%>%
dplyr::select(year, species, bb.jd, l75.jd) %>%
filter(species%in%sp)
d$year<-as.numeric(d$year)
d$risk<-d$l75.jd-d$bb.jd
d<-na.omit(d)
df<-d%>%
gather("phenophase", "doy", bb.jd, l75.jd)
x<-paste(df$year, df$doy)
df$Date<-as.Date(strptime(x, format="%Y %j"))
## Weather data
w<-weather %>%
filter(Site == "hf")%>%
filter(JD<=180)
w$AirT<-ifelse(is.na(w$AirT), 0, w$AirT)
w$gdd <- w$AirT - 5
w$gdd <-ifelse(w$gdd>0, w$gdd, 0)
w$count <- ave(
w$gdd, w$Year,
FUN=function(x) cumsum(c(0, head(x, -1)))
)
w<-dplyr::rename(w, year=Year)
w<-dplyr::rename(w, doy=JD)
x<-paste(w$year, w$doy)
w$Date<-as.Date(strptime(x, format="%Y %j"))
w$frz<-ifelse(w$AirTMin<0, 1, 0)
w$freezes<-ave(
w$frz, w$Year,
FUN=function(x) cumsum(c(0, head(x, -1)))
)
w$freezes<-ave(
w$frz, w$year,
FUN=function(x) cumsum(c(0, head(x, -1)))
)
dxx<-d
dxx$fs.lo<-NA
for(i in c(1:nrow(w))){
for(j in c(1:nrow(dxx)))
dxx$fs.lo[j]<-ifelse(dxx$bb.jd[j]==w$doy[i] & dxx$year[j]==w$year[i], w$freezes[i], dxx$fs.lo[j])
}
dxx<-d
dxx$fs.lo<-NA
for(i in c(1:nrow(w))){
for(j in c(1:nrow(dxx)))
dxx$fs.lo[j]<-ifelse(dxx$l75.jd[j]==w$doy[i] & dxx$year[j]==w$year[i], w$freezes[i], dxx$fs.lo[j])
}
dxx$fs.bb<-NA
for(i in c(1:nrow(w))){
for(j in c(1:nrow(dxx)))
dxx$fs.bb[j]<-ifelse(dxx$bb.jd[j]==w$doy[i] & dxx$year[j]==w$year[i], w$freezes[i], dxx$fs.bb[j])
}
dxx$afrzs<-dxx$fs.lo-dxx$fs.bb
View(dxx)
setwd("~/Documents/git/springfreeze")
timeline<-read.csv("input/hf003-06-mean-spp.csv", header=TRUE)
weather<-read.csv("input/WeatherData.csv", header=TRUE)
hf<-timeline[!is.na(timeline$l75.jd),]
spp<-as.data.frame(table(hf$species))
spp$include<-ifelse(spp$Freq==25, TRUE, NA)
spp<-spp[!is.na(spp$include),]
sp<-unique(spp$Var1)
d<-timeline%>%
dplyr::select(year, species, bb.jd, l75.jd) %>%
filter(species%in%sp)
d$year<-as.numeric(d$year)
d$risk<-d$l75.jd-d$bb.jd
d<-na.omit(d)
df<-d%>%
gather("phenophase", "doy", bb.jd, l75.jd)
x<-paste(df$year, df$doy)
df$Date<-as.Date(strptime(x, format="%Y %j"))
## Weather data
w<-weather %>%
filter(Site == "hf")%>%
filter(JD<=180)
w$AirT<-ifelse(is.na(w$AirT), 0, w$AirT)
w$gdd <- w$AirT - 5
w$gdd <-ifelse(w$gdd>0, w$gdd, 0)
w$count <- ave(
w$gdd, w$Year,
FUN=function(x) cumsum(c(0, head(x, -1)))
)
w<-dplyr::rename(w, year=Year)
w<-dplyr::rename(w, doy=JD)
x<-paste(w$year, w$doy)
w$Date<-as.Date(strptime(x, format="%Y %j"))
w<-w[!is.na(w$AirTMin),]
w$frz<-ifelse(w$AirTMin<0, 1, 0)
w$freezes<-ave(
w$frz, w$year,
FUN=function(x) cumsum(c(0, head(x, -1)))
)
#w<-dplyr::select(w, Date, gdd, count, frz)
#w$year<-as.numeric(substr(w$Date, 1, 4))
dxx<-d
dxx$fs.lo<-NA
for(i in c(1:nrow(w))){
for(j in c(1:nrow(dxx)))
dxx$fs.lo[j]<-ifelse(dxx$l75.jd[j]==w$doy[i] & dxx$year[j]==w$year[i], w$freezes[i], dxx$fs.lo[j])
}
dxx$fs.bb<-NA
for(i in c(1:nrow(w))){
for(j in c(1:nrow(dxx)))
dxx$fs.bb[j]<-ifelse(dxx$bb.jd[j]==w$doy[i] & dxx$year[j]==w$year[i], w$freezes[i], dxx$fs.bb[j])
}
dxx$afrzs<-dxx$fs.lo-dxx$fs.bb
View(dxx)
m1<-lm(agdd~afrzs, data=dxx)
View(d)
View(d)
View(dxx)
dxx$risk<-dxx$l75.jd-dxx$bb.jd
m1<-lm(risk~afrzs, data=dxx)
display(m1)
View(dxx)
m1<-lm(afrzs~year, data=dxx)
display(m1)
dx<-inner_join(df,w)
count<-dplyr::select(dx, doy, year, count)
count<-count[!duplicated(count),]
count$doy<-as.numeric(count$doy)
count<-filter(count, count<=500)
gdd<-d
gdd$bb.jd<-as.numeric(gdd$bb.jd)
gdd$bb.gdd<-NA
gdd$l75.gdd<-NA
for(i in c(1:nrow(gdd))){
for(j in c(1:nrow(count)))
gdd$bb.gdd[i]<-ifelse(gdd$bb.jd[i]==count$doy[j] & gdd$year[i]==count$year[j], count$count[j], gdd$bb.gdd[i])
}
for(i in c(1:nrow(gdd))){
for(j in c(1:nrow(count)))
gdd$l75.gdd[i]<-ifelse(gdd$l75.jd[i]==count$doy[j] & gdd$year[i]==count$year[j], count$count[j], gdd$l75.gdd[i])
}
gdd$agdd<-gdd$l75.gdd-gdd$bb.gdd
View(gdd)
gx<-full_join(dxx, gdd)
View(gx)
m1<-lm(agdd~afrzs, data=dxx)
m1<-lm(agdd~afrzs, data=gx)
display(m1)
gx$z.agdd<-scale(gx$agdd, center=TRUE, scale=FALSE)
m1<-lm(risk~afrzs+z.agdd, data=gx)
display(m1)
m1<-lm(z.agdd~afrzs, data=gx)
display(m1)
m1<-lm(risk~afrzs+afrzs*z.agdd, data=gx)
display(m1)
years<-c("2010", "2014")
gx<-filter(gx, year%in%years)
View(gx)
gx<-full_join(dxx, gdd)
years<-c("2010", "2014")
gx<-filter(gx, year%in%years)
View(gx)
m1<-lm(agdd~afrzs+as.factor(year), data=gx)
display(m1)
m1<-lm(agdd~afrzs+as.factor(year)+afrzs*as.factor(year), data=gx)
display(m1)
m1<-lm(agdd~afrzs+as.factor(year)+afrzs*year, data=gx)
display(m1)
gx$z.agdd<-scale(gx$agdd, center=TRUE, scale=FALSE)
m1<-lm(z.agdd~afrzs+as.factor(year), data=gx)
display(m1)
m1<-lm(risk~afrzs+as.factor(year)+agdd, data=gx)
display(m1)
m1<-lm(risk~afrzs+as.factor(year)+z.agdd, data=gx)
display(m1)
