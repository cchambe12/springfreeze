d.total<-d.total[!duplicated(d.total),]
d.total$num.years<-ave(d.total$year, d.total[,("prov")], FUN=length)
d.aes <- merge(d.total, d.aes, by=c('prov', 'year'), sort = FALSE)
d.aes$num.years<-as.numeric(d.aes$num.years)
fs<-d.aes%>%dplyr::select(prov, year, freezes)
fs<-fs[!duplicated(fs),]
fs$freezes<-ifelse(fs$freezes>0,1,NA)
fs<-na.omit(fs)
fs<-fs[!duplicated(fs),]
fs$frz.years<-ave(fs$freezes, fs[,("prov")], FUN=length)
fs<-dplyr::select(-freezes)
fs<-dplyr::select(fs,-freezes)
d.aes <- merge(fs, d.aes, by=c('prov', 'year'), sort = FALSE)
d.aes$frequency<-as.numeric(d.aes$frz.years/d.aes$num.years)
mod<-lm(frequency~lat*long, data=d.aes)
summary(mod)
mod<-lm(frequency~risk, data=d.aes)
summary(mod)
d.aes<-df
d.aes$year<-substr(d.aes$date, 0,4)
d.aes$frz<-ifelse(d.aes$Tmin<=-2.2, 1, 0)
d.aes$freezes <- ave(
d.aes$frz, d.aes$prov, d.aes$year,
FUN=function(x) cumsum(c(0, head(x, -1)))
)
df<-data.frame(x, y, z)
df<-data.frame(x=x, y=y, z=z)
doy<- 90:150
bb<-c(95, 122)
lf<-c(100, 142)
species<-c("ILEMUC", "BETALL")
risk<-c("low", "med", "high", "med")
df<-data.frame(doy, bb, lf, species, risk)
df<-data.frame(doy, bb=NA, lf=NA, species=NA, risk=NA)
View(df)
doy<- 90:150
df<-data.frame(doy, phase=NA, species=NA, risk=NA)
df$phase<-ifelse(df$doy==95, "BB", df$phase)
df$phase<-ifelse(df$doy==100, "LO", df$phase)
df$species<-ifelse(df$doy==95, "ILEMUC", df$species)
df$species<-ifelse(df$doy==100, "ILEMUC", df$species)
df$phase<-ifelse(df$doy==122, "BB", df$phase)
df$phase<-ifelse(df$doy==142, "LO", df$phase)
df$species<-ifelse(df$doy==122, "BETALL", df$species)
df$species<-ifelse(df$doy==142, "BETALL", df$species)
df$risk<-ifelse(df$doy>=96 & df$doy<=99 & df$species=="ILEMUC", 10, df$risk)
df$risk<-ifelse(df$doy>=124 & df$doy<=140 & df$species=="BETALL", 10, df$risk)
df$risk<-ifelse(df$doy>=90 & df$doy<=94 & df$species=="ILEMUC", 3, df$risk)
df$risk<-ifelse(df$doy>=90 & df$doy<=120 & df$species=="BETALL", 3, df$risk)
df$risk<-ifelse(df$doy>=101 & df$species=="ILEMUC", 5, df$risk)
df$risk<-ifelse(df$doy>=146 & df$species=="BETALL", 5, df$risk)
View(df)
df$risk<-ifelse(df$doy>=96 && df$doy<=99 && df$species=="ILEMUC", 10, df$risk)
View(df)
doy<- 90:150
ile<-data.frame(doy, phase=NA, risk=NA)
ile$phase<-ifelse(ile$doy==95, "BB", ile$phase)
ile$phase<-ifelse(ile$doy==100, "LO", ile$phase)
ile$risk<-ifelse(ile$doy>=96 && ile$doy<=99, 10, ile$risk)
ile$risk<-ifelse(ile$doy>=90 & ile$doy<=94, 3, ile$risk)
ile$risk<-ifelse(ile$doy>=101, 5, ile$risk)
View(ile)
ile$risk<-ifelse(ile$doy>=96 & ile$doy<=99, 10, ile$risk)
bet<-data.frame(doy, phase=NA, risk=NA)
bet$phase<-ifelse(bet$doy==122, "BB", bet$phase)
bet$phase<-ifelse(bet$doy==142, "LO", bet$phase)
bet$risk<-ifelse(bet$doy>=124 & bet$doy<=140, 10, bet$risk)
bet$risk<-ifelse(bet$doy>=90 & bet$doy<=120, 3, bet$risk)
bet$risk<-ifelse(bet$doy>=146, 5, bet$risk)
View(bet)
ile<-ggplot(ile, aes(x=doy, y=risk)) + geom_line()
library(ggplot)
library(ggplot2)
ile<-ggplot(ile, aes(x=doy, y=risk)) + geom_line()
ile
doy<- 75:150
ile<-data.frame(doy, phase=NA, risk=NA)
ile$phase<-ifelse(ile$doy==95, "BB", ile$phase)
ile$phase<-ifelse(ile$doy==100, "LO", ile$phase)
ile$risk<-ifelse(ile$doy>=96 & ile$doy<=99, 10, ile$risk)
ile$risk<-ifelse(ile$doy>=75 & ile$doy<=94, 3, ile$risk)
ile$risk<-ifelse(ile$doy>=101, 5, ile$risk)
bet<-data.frame(doy, phase=NA, risk=NA)
bet$phase<-ifelse(bet$doy==122, "BB", bet$phase)
bet$phase<-ifelse(bet$doy==142, "LO", bet$phase)
bet$risk<-ifelse(bet$doy>=124 & bet$doy<=140, 10, bet$risk)
bet$risk<-ifelse(bet$doy>=75 & bet$doy<=120, 3, bet$risk)
bet$risk<-ifelse(bet$doy>=146, 5, bet$risk)
ile<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + geom_point()
ile
ile<-ggplot(ile, aes(x=doy, y=risk)) + geom_line()
ile<-ggplot(ile, aes(x=doy, y=risk)) + geom_line()
doy<- 75:150
ile<-data.frame(doy, phase=NA, risk=NA)
ile$phase<-ifelse(ile$doy==95, "BB", ile$phase)
ile$phase<-ifelse(ile$doy==100, "LO", ile$phase)
ile$risk<-ifelse(ile$doy>=96 & ile$doy<=99, 10, ile$risk)
ile$risk<-ifelse(ile$doy>=75 & ile$doy<=94, 3, ile$risk)
ile$risk<-ifelse(ile$doy>=101, 5, ile$risk)
bet<-data.frame(doy, phase=NA, risk=NA)
bet$phase<-ifelse(bet$doy==122, "BB", bet$phase)
bet$phase<-ifelse(bet$doy==142, "LO", bet$phase)
bet$risk<-ifelse(bet$doy>=124 & bet$doy<=140, 10, bet$risk)
bet$risk<-ifelse(bet$doy>=75 & bet$doy<=120, 3, bet$risk)
bet$risk<-ifelse(bet$doy>=146, 5, bet$risk)
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line()
ilemuc
doy<- 75:150
ile<-data.frame(doy, phase=NA, risk=NA)
ile$phase<-ifelse(ile$doy==95, "BB", ile$phase)
ile$phase<-ifelse(ile$doy==100, "LO", ile$phase)
ile$risk<-ifelse(ile$doy>=96 & ile$doy<=99, 10, ile$risk)
ile$risk<-ifelse(ile$doy==95, 6.5, ile$risk)
ile$risk<-ifelse(ile$doy==100, 7.5, ile$risk)
ile$risk<-ifelse(ile$doy>=75 & ile$doy<=94, 3, ile$risk)
ile$risk<-ifelse(ile$doy>=101, 5, ile$risk)
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line()
ilemuc
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:10)
ilemuc
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20)
ilemuc
bet<-data.frame(doy, phase=NA, risk=NA)
bet$phase<-ifelse(bet$doy==122, "BB", bet$phase)
bet$phase<-ifelse(bet$doy==142, "LO", bet$phase)
bet$risk<-ifelse(bet$doy>=124 & bet$doy<=140, 10, bet$risk)
ile$risk<-ifelse(ile$doy==123, 6.5, ile$risk)
ile$risk<-ifelse(ile$doy==141, 7.5, ile$risk)
bet$risk<-ifelse(bet$doy>=75 & bet$doy<=122, 3, bet$risk)
bet$risk<-ifelse(bet$doy>=142, 5, bet$risk)
betall<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20)
betall
bet<-data.frame(doy, phase=NA, risk=NA)
bet$phase<-ifelse(bet$doy==122, "BB", bet$phase)
bet$phase<-ifelse(bet$doy==142, "LO", bet$phase)
bet$risk<-ifelse(bet$doy>=124 & bet$doy<=140, 10, bet$risk)
ile$risk<-ifelse(bet$doy==123, 6.5, bet$risk)
ile$risk<-ifelse(bet$doy==141, 7.5, bet$risk)
bet$risk<-ifelse(bet$doy>=75 & bet$doy<=122, 3, bet$risk)
bet$risk<-ifelse(bet$doy>=142, 5, bet$risk)
betall<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20)
betall
bet<-data.frame(doy, phase=NA, risk=NA)
bet$phase<-ifelse(bet$doy==122, "BB", bet$phase)
bet$phase<-ifelse(bet$doy==142, "LO", bet$phase)
bet$risk<-ifelse(bet$doy>=124 & bet$doy<=140, 10, bet$risk)
bet$risk<-ifelse(bet$doy==123, 6.5, bet$risk)
bet$risk<-ifelse(bet$doy==141, 7.5, bet$risk)
bet$risk<-ifelse(bet$doy>=75 & bet$doy<=122, 3, bet$risk)
bet$risk<-ifelse(bet$doy>=142, 5, bet$risk)
betall<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20)
betall
betall<-ggplot(bet, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20)
betall
grid.arrange(ilemuc, betall, ncol=1, nrow=2)
library(gridExtra)
grid.arrange(ilemuc, betall, ncol=1, nrow=2)
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
geom_label(x = 82:97, y = 1:6)
ilemuc
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotation_custom(df, xmin=82, xmax=97, ymin=1, ymax=6)
ilemuc
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0)
ilemuc
doy<- 75:150
ile<-data.frame(doy, phase=NA, risk=NA)
ile$phase<-ifelse(ile$doy==95, "BB", ile$phase)
ile$phase<-ifelse(ile$doy==100, "LO", ile$phase)
ile$risk<-ifelse(ile$doy>=96 & ile$doy<=99, 10, ile$risk)
ile$risk<-ifelse(ile$doy==95, 6.5, ile$risk)
ile$risk<-ifelse(ile$doy==100, 7.5, ile$risk)
ile$risk<-ifelse(ile$doy>=75 & ile$doy<=94, 3, ile$risk)
ile$risk<-ifelse(ile$doy>=101, 5, ile$risk)
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0)
ilemuc
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0.2)
ilemuc
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0.2, color="red")
ilemuc
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, color="red")
ilemuc
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0.1, color="red")
ilemuc
doy<- 75:150
ile<-data.frame(doy, phase=NA, risk=NA)
ile$phase<-ifelse(ile$doy==95, "BB", ile$phase)
ile$phase<-ifelse(ile$doy==100, "LO", ile$phase)
ile$risk<-ifelse(ile$doy>=96 & ile$doy<=99, 10, ile$risk)
ile$risk<-ifelse(ile$doy==95, 6.5, ile$risk)
ile$risk<-ifelse(ile$doy==100, 7.5, ile$risk)
ile$risk<-ifelse(ile$doy>=75 & ile$doy<=94, 3, ile$risk)
ile$risk<-ifelse(ile$doy>=101, 4, ile$risk)
bet<-data.frame(doy, phase=NA, risk=NA)
bet$phase<-ifelse(bet$doy==122, "BB", bet$phase)
bet$phase<-ifelse(bet$doy==142, "LO", bet$phase)
bet$risk<-ifelse(bet$doy>=124 & bet$doy<=140, 10, bet$risk)
bet$risk<-ifelse(bet$doy==123, 6.5, bet$risk)
bet$risk<-ifelse(bet$doy==141, 7.5, bet$risk)
bet$risk<-ifelse(bet$doy>=75 & bet$doy<=122, 3, bet$risk)
bet$risk<-ifelse(bet$doy>=142, 4, bet$risk)
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0.1, color="red")
betall<-ggplot(bet, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0.1, color="red")
grid.arrange(ilemuc, betall, ncol=1, nrow=2)
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0.1, color="red") +
xlab("Day of Year") + ylab("Frost Damage Risk") +
annotate("text", x = 140:150, y = 25, label = "ILEMUC")
betall<-ggplot(bet, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0.1, color="red") +
xlab("Day of Year") + ylab("Frost Damage Risk") +
annotate("text", x = 140:150, y = 25, label = "BETALL")
grid.arrange(ilemuc, betall, ncol=1, nrow=2)
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0.1, color="red") +
xlab("Day of Year") + ylab("Frost Damage Risk") +
annotate("text", x = 140:150, y = 18, label = "ILEMUC")
betall<-ggplot(bet, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0.1, color="red") +
xlab("Day of Year") + ylab("Frost Damage Risk") +
annotate("text", x = 140:150, y = 18, label = "BETALL")
grid.arrange(ilemuc, betall, ncol=1, nrow=2)
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0.1, color="red") +
xlab("Day of Year") + ylab("Frost Damage Risk") +
annotate("text", x = 140, y = 18, label = "ILEMUC")
betall<-ggplot(bet, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0.1, color="red") +
xlab("Day of Year") + ylab("Frost Damage Risk") +
annotate("text", x = 140, y = 18, label = "BETALL")
grid.arrange(ilemuc, betall, ncol=1, nrow=2)
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0.1, color="red") +
xlab("Day of Year") + ylab("Frost Damage Risk") +
annotate("text", x = 140, y = 18, label = "Ilex mucronata")
betall<-ggplot(bet, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0.1, color="red") +
xlab("Day of Year") + ylab("Frost Damage Risk") +
annotate("text", x = 140, y = 18, label = "Betula alleghaniensis")
grid.arrange(ilemuc, betall, ncol=1, nrow=2)
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0.1, color="red") +
xlab("Day of Year") + ylab("Frost Damage Risk") +
annotate("text", x = 140, y = 18, label = "Ilex mucronata")
betall<-ggplot(bet, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0.1, color="red") +
xlab("Day of Year") + ylab("Frost Damage Risk") +
annotate("text", x = 135, y = 18, label = "Betula alleghaniensis")
grid.arrange(ilemuc, betall, ncol=1, nrow=2)
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0.1, color="red") +
xlab("Day of Year") + ylab("Frost Damage Risk") +
annotate("text", x = 140, y = 18, label = "Ilex mucronata")
betall<-ggplot(bet, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0.1, color="red") +
xlab("Day of Year") + ylab("Frost Damage Risk") +
annotate("text", x = 137, y = 18, label = "Betula alleghaniensis")
grid.arrange(ilemuc, betall, ncol=1, nrow=2)
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0.1, color="red") +
xlab("Day of Year") + ylab("Frost Damage Risk") +
annotate("text", x = 140, y = 18, label = "Ilex mucronata")
betall<-ggplot(bet, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0.1, color="red") +
xlab("Day of Year") + ylab("Frost Damage Risk") +
annotate("text", x = 140, y = 18, label = "Betula alleghaniensis")
grid.arrange(ilemuc, betall, ncol=1, nrow=2)
rm(list=ls()) # remove everything currently held in the R memory
options(stringsAsFactors=FALSE)
graphics.off()
# Load libraries
library(dplyr)
library(tidyr)
library(ggplot2)
library(lubridate)
# Set Working Directory
setwd("~/Documents/git/freezingexperiment/analyses/input")
d<-read.csv("weather_allsites.csv", header=TRUE)
d<-dplyr::rename(d, doy=Julian.Date)
d$year<-substr(d$Date, 7, 10)
### Harvard Forest #####
hf<-d%>%filter(site=="hf")%>%filter(year>=1990)
hf<-hf %>% filter(doy <=240)
hf$gdd <- hf$AirTMax - 5 # Can be 0 here if want 0 degC as threshold
hf$gdd <-ifelse(hf$gdd>0, hf$gdd, 0)
hf$count <- ave(
hf$gdd, hf$year,
FUN=function(x) cumsum(c(0, head(x, -1)))
)
hf$frz<- ifelse((hf$AirTMin<=-2.2), 1, 0)
hf$fs<- ifelse((hf$count >= 200 & hf$frz == 1 & hf$count<=300), TRUE, NA)
hf.fsi<-hf%>%dplyr::select(year, fs)
hf.fsi<-hf.fsi[!duplicated(hf.fsi),]
hf.fsi<-na.omit(hf.fsi)
hf.last<-hf%>%filter(frz>0)
hf.last<-hf.last[order(hf.last$doy,hf.last$year),]
hf.last<-hf.last[!duplicated(hf.last$year, fromLast=TRUE),]
hf.last$last<-hf.last$Date
View(hf)
View(hf.fsi)
View(hf.last)
write.csv(hf.last, file="~Documents/git/freezingexperiment/analyses/output/hf_fsi.csv", row.names = FALSE)
write.csv(hf.last, file="~/Documents/git/freezingexperiment/analyses/output/hf_fsi.csv", row.names = FALSE)
library(dplyr)
library(tidyr)
library(ggplot2)
# Integrate Phenology Data and compare methodologies
# Set Working Directory
setwd("~/Documents/git/springfreeze/input")
bb<-read.csv("hf003-06-mean-spp.csv",header=TRUE, sep=",")
d<-read.csv("~/Documents/git/freezingexperiment/analyses/output/hf_fsi.csv", header=TRUE)
View(bb)
View(d)
bb<-dplyr::select(bb, year, species, bb.jd, l15.jd)
bb<-dplyr::select(bb, year, species, bb.jd, l75.jd)
library(lubridate)
x<-paste(bb$year, bb$bb.jd)
bb$bb.day<-as.Date(strptime(x, format="%Y %j"))
y<-paste(bb$year, bb$l75.jd)
bb$l75.day<-as.Date(strptime(y, format="%Y %j"))
View(bb)
d<-dplyr::rename(d, doy=Julian.Date)
d$year<-substr(d$Date, 7, 10)
hf<-d%>%filter(site=="hf")%>%filter(year>=1990)
hf<-hf %>% filter(doy <=240)
hf$gdd <- hf$AirTMax - 5 # Can be 0 here if want 0 degC as threshold
hf$gdd <-ifelse(hf$gdd>0, hf$gdd, 0)
hf$count <- ave(
hf$gdd, hf$year,
FUN=function(x) cumsum(c(0, head(x, -1)))
)
View(hf)
d<-read.csv("~/Documents/git/freezingexperiment/analyses/input/weather_allsites.csv", header=TRUE)
d<-dplyr::rename(d, doy=Julian.Date)
d$year<-substr(d$Date, 7, 10)
hf<-d%>%filter(site=="hf")%>%filter(year>=1990)
hf<-hf %>% filter(doy <=240)
hf$gdd <- hf$AirTMax - 5 # Can be 0 here if want 0 degC as threshold
hf$gdd <-ifelse(hf$gdd>0, hf$gdd, 0)
hf$count <- ave(
hf$gdd, hf$year,
FUN=function(x) cumsum(c(0, head(x, -1)))
)
View(hf)
df<-full_join(hf, bb)
hf<-dplyr::select(year, doy, count)
hf<-dplyr::select(hf, year, doy, count)
View(hf)
hf$year
class(hf$year)
hf$year<-as.numeric(hf$year)
class(hf$year)
df<-full_join(hf, bb)
View(df)
bb<- gather(bb, key = doy, value = phase,
bb.jd, l75.jd)
View(bb)
bb<- gather(bb, key = phase, value = doy,
bb.jd, l75.jd)
bb<-read.csv("hf003-06-mean-spp.csv",header=TRUE, sep=",")
bb<-dplyr::select(bb, year, species, bb.jd, l75.jd)
bb<- gather(bb, key = phase, value = doy,
bb.jd, l75.jd)
View(bb)
df<-full_join(hf, bb)
View(df)
df %>% group_by(year, species) %>% summarise(risk = doy[phase==l75.jd]- risk[doy==bb.jd])
df %>% group_by(year, species) %>% summarise(risk = doy[phase=="l75.jd"]- risk[doy=="bb.jd"])
df %>% group_by(year, species) %>% summarise(risk = doy[phase=="l75.jd"]- risk[doy=="bb.jd"])
df$risk<-NA
df %>% group_by(year, species) %>% summarise(risk = doy[phase=="l75.jd"]- risk[doy=="bb.jd"])
dx<-df %>% group_by(year, species) %>% summarise(risk = doy[phase=="l75.jd"]- risk[doy=="bb.jd"])
View(dx)
df<-full_join(hf, bb)
dx<-df
dx$risk<- ave(
dx$year, dx$species,
FUN=function(x) dx$doy[phase=="l75.jd"]-dx$doy[phase=="bb.jd"]
)
dx$risk<- ave(
dx$year, dx$species,
FUN=function(x) dx$doy[dx$phase=="l75.jd"]-dx$doy[dx$phase=="bb.jd"]
)
warnings()
View(dx)
dx<-dx[dx$doy[dx$phase=="l75.jd"]-dx$doy[phase=="bb.jd"], by=c(dx$year, dx$species)]
for(i in unique(sp.year)){
dx$risk[i]<-dx$l75.jd[i]-dx$bb.jd[i]
}
dx$sp.year<-paste(dx$species, dx$year)
for(i in unique(sp.year)){
dx$risk[i]<-dx$l75.jd[i]-dx$bb.jd[i]
}
for(i in unique(dx$sp.year)){
dx$risk[i]<-dx$l75.jd[i]-dx$bb.jd[i]
}
dx$sp.year<-paste(dx$species, dx$year)
for(i in unique(dx$sp.year)){
dx$risk<-dx$l75.jd[i]-dx$bb.jd[i]
}
dx<-df%>%dplyr::select(year, species, l75.jd, bb.jd)
dx$sp.year<-paste(dx$species, dx$year)
for(i in unique(dx$sp.year)){
dx$risk<-dx$l75.jd[i]-dx$bb.jd[i]
}
dx<-df%>%dplyr::select(year, species, doy, phase)
dx$sp.year<-paste(dx$species, dx$year)
for(i in unique(dx$sp.year)){
dx$risk<-dx$l75.jd[i]-dx$bb.jd[i]
}
for(i in length(dx$sp.year)){
dx$risk<-dx$l75.jd[i]-dx$bb.jd[i]
}
View(dx)
View(df)
dx<-na.omit(dx)
View(dx)
for(i in length(dx$sp.year)){
dx$risk<-dx$l75.jd[i]-dx$bb.jd[i]
}
View(dx)
dx$risk<-NA
for(i in length(dx$sp.year)){
dx$risk<-dx$l75.jd[i]-dx$bb.jd[i]
}
for(i in length(dx$sp.year)){
dx$risk[i]<-dx$l75.jd-dx$bb.jd
}
for(i in length(dx$sp.year)){
dx$risk<-dx$doy[phase=="l75.jd"][i]-dx$doy[phase=="bb.jd"][i]
}
for(i in length(dx$sp.year)){
dx$risk<-dx$doy[dx$phase=="l75.jd"][i]-dx$doy[dx$phase=="bb.jd"][i]
}
View(dx)
for(i in length(dx$sp.year)){
dx$risk[i]<-dx$doy[dx$phase=="l75.jd"]-dx$doy[dx$phase=="bb.jd"]
}
for(i in unique(dx$sp.year)){
dx$risk[i]<-dx$doy[dx$phase=="l75.jd"]-dx$doy[dx$phase=="bb.jd"]
}
for(i in unique(dx$sp.year)){
dx$risk<-dx$doy[dx$phase=="l75.jd"][i]-dx$doy[dx$phase=="bb.jd"][i]
}
View(dx)
class(dx$doy)
dx$risk<-dx$doy[dx$phase=="l75.jd"]-dx$doy[dx$phase=="bb.jd"]
dx$risk<-within(dx$sp.year[i][dx$doy[dx$phase=="l75.jd"]-dx$doy[dx$phase=="bb.jd"]])
for(i in unique(dx$sp.year)){
dx$risk<-within(dx$sp.year[i][dx$doy[dx$phase=="l75.jd"]-dx$doy[dx$phase=="bb.jd"]])
}
dx$risk<-within(dx$sp.year[dx$doy[dx$phase=="l75.jd"][i]-dx$doy[dx$phase=="bb.jd"][i]])
dx<- gather(dx, key = bb.jd, value = l75.jd,
doy, phase)
View(dx)
rm(list=ls()) # remove everything currently held in the R memory
options(stringsAsFactors=FALSE)
graphics.off()
# Load libraries
library(dplyr)
library(tidyr)
library(ggplot2)
library(lubridate)
# Integrate Phenology Data and compare methodologies
# Set Working Directory
setwd("~/Documents/git/springfreeze/input")
bb<-read.csv("hf003-06-mean-spp.csv",header=TRUE, sep=",")
d<-read.csv("~/Documents/git/freezingexperiment/analyses/input/weather_allsites.csv", header=TRUE)
bb<-dplyr::select(bb, year, species, bb.jd, l75.jd)
#x<-paste(bb$year, bb$bb.jd)
#bb$bb.day<-as.Date(strptime(x, format="%Y %j"))
#y<-paste(bb$year, bb$l75.jd)
#bb$l75.day<-as.Date(strptime(y, format="%Y %j"))
bx<- gather(bb, key = phase, value = doy,
bb.jd, l75.jd)
d<-dplyr::rename(d, doy=Julian.Date)
d$year<-substr(d$Date, 7, 10)
hf<-d%>%filter(site=="hf")%>%filter(year>=1990)
hf<-hf %>% filter(doy <=240)
hf$gdd <- hf$AirTMax - 5 # Can be 0 here if want 0 degC as threshold
hf$gdd <-ifelse(hf$gdd>0, hf$gdd, 0)
hf$count <- ave(
hf$gdd, hf$year,
FUN=function(x) cumsum(c(0, head(x, -1)))
)
hf<-dplyr::select(hf, year, doy, count)
hf$year<-as.numeric(hf$year)
df<-full_join(hf, bx)
dx<-full_join(hf, bb)
View(dx)
dx<-dx%>%dplyr::select(year, species, bb.jd, l75.jd)
dx$risk<-dx$l75.jd-dx$bb.jd
View(df)
df<-na.omit(df)
View(df)
mod<-lm(doy~count+year+species, data=df[phase=="bb.jd"])
View(df)
mod<-lm(doy~count+year+species, data=df[subset(phase=="bb.jd")])
mod<-lm(doy~count+year+species, data=df[subset(df$phase=="bb.jd")])
mod<-lm(doy~count+year+species, data=df[df$phase=="bb.jd"])
mod<-lm(doy~count+year+species, data=df, subset=(phase=="bb.jd"))
display(mod)
library(arm)
display(mod)
